name: ğŸ”„ Email Campaign Auto-Restart

on:
  schedule:
    # Executa a cada 5 minutos para verificar campanhas travadas
    - cron: '*/5 * * * *'
  
  # Permite execuÃ§Ã£o manual tambÃ©m
  workflow_dispatch:

jobs:
  auto-restart-campaigns:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸš€ Trigger Email Auto-Restart
      run: |
        echo "ğŸ”„ Executando verificaÃ§Ã£o automÃ¡tica de campanhas de email..."
        
        response=$(curl -s -w "HTTPSTATUS:%{http_code}" \
          -X GET "https://www.fly2any.com/api/cron/email-auto-restart" \
          -H "User-Agent: GitHub-Actions-Cron/1.0")
        
        body=$(echo $response | sed -E 's/HTTPSTATUS:[0-9]{3}$//')
        code=$(echo $response | tr -d '\n' | sed -E 's/.*HTTPSTATUS:([0-9]{3})$/\1/')
        
        echo "ğŸ“Š Status HTTP: $code"
        echo "ğŸ“‹ Resposta: $body"
        
        if [ $code -eq 200 ]; then
          echo "âœ… Auto-restart executado com sucesso!"
        else
          echo "âŒ Erro no auto-restart (HTTP $code)"
          exit 1
        fi
    
    - name: ğŸ“ˆ Log Success
      if: success()
      run: echo "âœ… VerificaÃ§Ã£o automÃ¡tica de campanhas concluÃ­da com sucesso Ã s $(date)"
    
    - name: ğŸ“¢ Log Failure
      if: failure()
      run: echo "âŒ Falha na verificaÃ§Ã£o automÃ¡tica de campanhas Ã s $(date)"

# ğŸ“‹ CONFIGURAÃ‡ÃƒO AUTOMÃTICA:
# Este workflow serÃ¡ executado automaticamente a cada 5 minutos
# garantindo que campanhas travadas sejam reiniciadas rapidamente.
#
# ğŸ¯ BENEFÃCIOS:
# - âœ… Monitoramento contÃ­nuo 24/7
# - ğŸ”„ ReinÃ­cio automÃ¡tico de campanhas travadas
# - ğŸ“Š Logs detalhados no GitHub Actions
# - ğŸš€ Zero intervenÃ§Ã£o manual necessÃ¡ria
# - ğŸ’ª Sistema robusto e confiÃ¡vel
#
# ğŸ”§ PARA ATIVAR:
# 1. Commit este arquivo para o repositÃ³rio
# 2. GitHub Actions ativarÃ¡ automaticamente
# 3. Verificar logs em: RepositÃ³rio > Actions > Email Campaign Auto-Restart