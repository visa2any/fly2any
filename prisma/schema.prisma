generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("SUPABASE_POSTGRES_PRISMA_URL")
  directUrl = env("SUPABASE_POSTGRES_URL_NON_POOLING")
}

model User {
  id                       String                      @id @default(cuid())
  name                     String?
  email                    String                      @unique
  emailVerified            DateTime?
  image                    String?
  password                 String?
  firstName                String?
  lastName                 String?
  phone                    String?
  dateOfBirth              DateTime?
  gender                   String?
  country                  String?
  timezone                 String?
  bio                      String?
  avatarUrl                String?
  profileCompleted         Boolean                     @default(false)
  tripMatchCredits         Int                         @default(0)
  tripMatchLifetimeEarned  Int                         @default(0)
  tripMatchLifetimeSpent   Int                         @default(0)
  tripMatchPendingCredits  Int                         @default(0)
  tripMatchTier            String?
  tripMatchBonusMultiplier Float                       @default(1.0)
  fly2anyPoints            Int                         @default(0)
  fly2anyPointsLocked      Int                         @default(0)
  fly2anyPointsLifetime    Int                         @default(0)
  fly2anyPointsRedeemed    Int                         @default(0)
  liteApiGuestId           String?                     @unique
  hotelPointsBalance       Int                         @default(0)
  hotelPointsPending       Int                         @default(0)
  referralCode             String?                     @unique
  referredBy               String?
  referralLevel            Int                         @default(0)
  directReferralsCount     Int                         @default(0)
  totalNetworkSize         Int                         @default(0)
  createdAt                DateTime                    @default(now())
  updatedAt                DateTime                    @updatedAt
  lastLoginAt              DateTime?
  accounts                 Account[]
  adminUser                AdminUser?
  affiliate                Affiliate?                  @relation("UserAffiliate")
  agentClient              AgentClient?                @relation("UserAgentClient")
  aiConversations          AIConversation[]
  aiSessions               AISession[]                 @relation("AISessionUser")
  frequentTravelers        FrequentTraveler[]
  groupMemberships         GroupMember[]               @relation("GroupMemberships")
  loginHistory             LoginHistory[]
  notifications            Notification[]
  paymentMethods           PaymentMethod[]
  priceAlerts              PriceAlert[]
  promoCodeUsages          PromoCodeUsage[]
  pushSubscriptions        PushSubscription[]
  recentSearches           RecentSearch[]
  pointsFromBookings       ReferralPointsTransaction[] @relation("PointsCustomer")
  pointsEarned             ReferralPointsTransaction[] @relation("PointsEarner")
  savedSearches            SavedSearch[]
  sessions                 Session[]
  travelAgent              TravelAgent?                @relation("UserTravelAgent")
  travelDocuments          TravelDocument[]
  createdTrips             TripGroup[]                 @relation("TripCreator")
  tripMatchProfile         TripMatchUserProfile?       @relation("TripMatchProfile")
  preferences              UserPreferences?
  userSessions             UserSession[]
  wishlistItems            WishlistItem[]
  worldCupBookings         WorldCupBooking[]

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model UserPreferences {
  id                  String   @id @default(cuid())
  userId              String   @unique
  preferredCabinClass String?
  preferredAirlines   String[]
  homeAirport         String?
  emailNotifications  Boolean  @default(true)
  priceAlertEmails    Boolean  @default(true)
  dealAlerts          Boolean  @default(true)
  newsletterOptIn     Boolean  @default(false)
  notifications       Json?
  currency            String   @default("USD")
  language            String   @default("en")
  theme               String   @default("light")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

model SavedSearch {
  id           String   @id @default(cuid())
  userId       String
  name         String
  origin       String
  destination  String
  departDate   String
  returnDate   String?
  adults       Int      @default(1)
  children     Int      @default(0)
  infants      Int      @default(0)
  cabinClass   String   @default("economy")
  filters      Json?
  searchCount  Int      @default(1)
  lastSearched DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, lastSearched])
  @@map("saved_searches")
}

model PriceAlert {
  id                String    @id @default(cuid())
  userId            String
  origin            String
  destination       String
  departDate        String
  returnDate        String?
  currentPrice      Float
  targetPrice       Float
  currency          String    @default("USD")
  active            Boolean   @default(true)
  triggered         Boolean   @default(false)
  lastChecked       DateTime  @default(now())
  triggeredAt       DateTime?
  lastNotifiedAt    DateTime?
  notificationCount Int       @default(0)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, active])
  @@index([active])
  @@map("price_alerts")
}

model RecentSearch {
  id            String   @id @default(cuid())
  userId        String
  city          String
  country       String
  airportCode   String
  imageUrl      String?
  origin        String?
  price         Float
  originalPrice Float?
  departDate    String?
  returnDate    String?
  createdAt     DateTime @default(now())
  viewedAt      DateTime @default(now())
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, viewedAt])
  @@map("recent_searches")
}

model UserActivity {
  id        String   @id @default(cuid())
  userId    String?
  eventType String
  eventData Json?
  ipAddress String?
  userAgent String?
  referrer  String?
  createdAt DateTime @default(now())

  @@index([userId, createdAt])
  @@index([eventType, createdAt])
  @@map("user_activities")
}

model AIConversation {
  id                    String      @id @default(cuid())
  sessionId             String      @unique
  userId                String?
  status                String      @default("active")
  currentConsultantTeam String?
  conversationContext   Json?
  searchHistory         Json?
  metadata              Json
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
  user                  User?       @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages              AIMessage[]

  @@index([userId])
  @@index([sessionId])
  @@index([status])
  @@index([createdAt])
  @@map("ai_conversations")
}

model AIMessage {
  id              String         @id @default(cuid())
  conversationId  String
  role            String
  content         String
  consultantName  String?
  consultantTeam  String?
  consultantEmoji String?
  flightResults   Json?
  hotelResults    Json?
  timestamp       BigInt
  createdAt       DateTime       @default(now())
  conversation    AIConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([conversationId, timestamp])
  @@map("ai_messages")
}

model UserSession {
  id         String   @id @default(cuid())
  userId     String
  token      String   @unique
  device     String?
  browser    String?
  os         String?
  location   String?
  ipAddress  String?
  lastActive DateTime @default(now())
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, lastActive])
  @@map("user_sessions")
}

model LoginHistory {
  id        String   @id @default(cuid())
  userId    String
  device    String?
  browser   String?
  os        String?
  location  String?
  ipAddress String?
  success   Boolean  @default(true)
  timestamp DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@map("login_history")
}

model AISession {
  id                  String    @id @default(cuid())
  sessionId           String    @unique
  ipAddressHash       String
  ipAddressAnonymized String?
  userAgent           String?
  isAuthenticated     Boolean   @default(false)
  userId              String?
  email               String?
  name                String?
  conversationCount   Int       @default(0)
  lastActivity        DateTime  @default(now())
  createdAt           DateTime  @default(now())
  anonymizedAt        DateTime?
  user                User?     @relation("AISessionUser", fields: [userId], references: [id])

  @@index([ipAddressHash])
  @@index([userId])
  @@index([lastActivity])
  @@index([createdAt])
  @@map("ai_sessions")
}

model PriceHistory {
  id          String   @id @default(cuid())
  origin      String
  destination String
  departDate  String
  returnDate  String?
  price       Float
  currency    String   @default("USD")
  provider    String
  timestamp   DateTime @default(now())

  @@index([origin, destination, departDate])
  @@index([timestamp])
  @@map("price_history")
}

model PriceMonitorLog {
  id              String   @id @default(cuid())
  executionTime   DateTime @default(now())
  alertsChecked   Int
  alertsTriggered Int
  alertsFailed    Int
  errors          Json?
  duration        Int
  triggeredBy     String

  @@index([executionTime])
  @@map("price_monitor_logs")
}

model WishlistItem {
  id           String   @id @default(cuid())
  userId       String
  productType  String   @default("flight")
  productId    String?
  flightData   Json?
  hotelData    Json?
  productData  Json?
  notes        String?
  targetPrice  Float?
  notifyOnDrop Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, productType])
  @@index([userId, createdAt])
  @@map("wishlist_items")
}

model LoyaltyTransaction {
  id                   String   @id @default(cuid())
  userId               String
  type                 String
  source               String
  points               Int
  description          String
  bookingType          String?
  bookingReference     String?
  bookingAmount        Float?
  liteApiTransactionId String?  @unique
  createdAt            DateTime @default(now())

  @@index([userId])
  @@index([userId, type])
  @@index([userId, source])
  @@index([userId, createdAt])
  @@map("loyalty_transactions")
}

model VoucherRedemption {
  id               String   @id @default(cuid())
  userId           String?
  voucherCode      String
  voucherType      String
  discountValue    Float
  discountAmount   Float
  currency         String   @default("USD")
  bookingType      String
  bookingReference String
  bookingAmount    Float
  finalAmount      Float
  liteApiVoucherId String?
  redeemedAt       DateTime @default(now())

  @@index([userId])
  @@index([voucherCode])
  @@index([bookingReference])
  @@map("voucher_redemptions")
}

model PromoCode {
  id                 String           @id @default(cuid())
  code               String           @unique
  type               String
  value              Float
  currency           String           @default("USD")
  minSpend           Float?
  maxDiscount        Float?
  usageLimit         Int?
  usageCount         Int              @default(0)
  perUserLimit       Int              @default(1)
  applicableProducts String[]
  applicableHotels   String[]
  newUsersOnly       Boolean          @default(false)
  requiresAccount    Boolean          @default(false)
  requiresPWAApp     Boolean          @default(false)
  validFrom          DateTime
  validUntil         DateTime
  isActive           Boolean          @default(true)
  description        String?
  internalNote       String?
  createdBy          String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  usages             PromoCodeUsage[]

  @@index([code])
  @@index([isActive, validFrom, validUntil])
  @@map("promo_codes")
}

model FrequentTraveler {
  id                   String    @id @default(cuid())
  userId               String
  relationship         String?
  title                String?
  firstName            String
  middleName           String?
  lastName             String
  dateOfBirth          DateTime
  gender               String
  nationality          String?
  passportNumber       String?
  passportExpiry       DateTime?
  passportCountry      String?
  knownTravelerNumber  String?
  redressNumber        String?
  frequentFlyerNumbers Json?
  hotelLoyaltyNumbers  Json?
  email                String?
  phone                String?
  seatPreference       String?
  mealPreference       String?
  specialNeeds         String?
  isDefault            Boolean   @default(false)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isDefault])
  @@map("frequent_travelers")
}

model PaymentMethod {
  id                    String   @id @default(cuid())
  userId                String
  type                  String
  provider              String
  last4                 String?
  brand                 String?
  expiryMonth           Int?
  expiryYear            Int?
  cardholderName        String?
  billingAddress        Json?
  stripePaymentMethodId String?  @unique
  paypalAccountId       String?  @unique
  isDefault             Boolean  @default(false)
  nickname              String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isDefault])
  @@index([stripePaymentMethodId])
  @@map("payment_methods")
}

model TravelDocument {
  id                 String    @id @default(cuid())
  userId             String
  type               String
  documentNumber     String
  issuingCountry     String
  firstName          String
  lastName           String
  middleName         String?
  issuedDate         DateTime?
  expirationDate     DateTime
  frontImageUrl      String?
  backImageUrl       String?
  visaType           String?
  destinationCountry String?
  isVerified         Boolean   @default(false)
  notes              String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, type])
  @@index([expirationDate])
  @@map("travel_documents")
}

model PushSubscription {
  id        String   @id @default(cuid())
  userId    String
  endpoint  String   @unique
  p256dh    String
  auth      String
  userAgent String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("push_subscriptions")
}

model Notification {
  id        String    @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  priority  String    @default("medium")
  read      Boolean   @default(false)
  actionUrl String?
  metadata  Json?
  createdAt DateTime  @default(now())
  readAt    DateTime?
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, read])
  @@index([createdAt])
  @@map("notifications")
}

model ReferralNetworkRelationship {
  id                String    @id @default(cuid())
  referrerId        String
  refereeId         String
  level             Int
  status            String    @default("pending")
  signupCompletedAt DateTime?
  firstBookingAt    DateTime?
  lastActivityAt    DateTime?
  createdAt         DateTime  @default(now())
  totalBookings     Int       @default(0)
  totalRevenue      Decimal   @default(0) @db.Decimal(10, 2)
  totalPointsEarned Int       @default(0)

  @@unique([referrerId, refereeId])
  @@index([referrerId, level])
  @@index([refereeId])
  @@index([status])
  @@map("referral_network_relationships")
}

model ReferralPointsTransaction {
  id                String    @id @default(cuid())
  bookingId         String
  bookingAmount     Decimal   @db.Decimal(10, 2)
  productType       String
  productData       Json?
  earnerId          String
  customerId        String
  level             Int
  pointsRate        Int
  productMultiplier Decimal   @default(1.0) @db.Decimal(3, 2)
  pointsCalculated  Int
  pointsAwarded     Int
  status            String    @default("locked")
  tripStartDate     DateTime?
  tripEndDate       DateTime?
  tripCompletedAt   DateTime?
  tripCancelled     Boolean   @default(false)
  tripCancelledAt   DateTime?
  tripRefunded      Boolean   @default(false)
  pointsLockedAt    DateTime  @default(now())
  pointsUnlockedAt  DateTime?
  pointsExpireAt    DateTime?
  pointsUsed        Boolean   @default(false)
  pointsUsedAt      DateTime?
  pointsUsedIn      String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  customer          User      @relation("PointsCustomer", fields: [customerId], references: [id], onDelete: Cascade)
  earner            User      @relation("PointsEarner", fields: [earnerId], references: [id], onDelete: Cascade)

  @@unique([bookingId, earnerId, level], name: "unique_booking_earner_level")
  @@index([earnerId, status])
  @@index([customerId])
  @@index([bookingId])
  @@index([tripEndDate])
  @@index([pointsUnlockedAt])
  @@map("referral_points_transactions")
}

model Referral {
  id         String    @id @default(cuid())
  referrerId String
  refereeId  String?
  code       String    @unique
  status     String    @default("pending")
  rewardPaid Boolean   @default(false)
  usedAt     DateTime?
  createdAt  DateTime  @default(now())
  expiresAt  DateTime

  @@index([referrerId])
  @@index([refereeId])
  @@index([code])
  @@index([status])
  @@map("referrals")
}

model CreditTransaction {
  id          String    @id @default(cuid())
  userId      String
  type        String
  amount      Int
  source      String
  status      String    @default("completed")
  description String?
  metadata    Json?
  createdAt   DateTime  @default(now())
  processedAt DateTime?

  @@index([userId, createdAt])
  @@index([type, createdAt])
  @@index([status])
  @@map("credit_transactions")
}

model TripGroup {
  id                      String        @id @default(cuid())
  creatorId               String
  title                   String
  name                    String?
  slug                    String        @unique
  destination             String
  destinationCode         String?
  coverImageUrl           String?
  description             String
  highlights              String[]
  startDate               DateTime
  endDate                 DateTime
  duration                Int
  minMembers              Int           @default(2)
  maxMembers              Int           @default(20)
  currentMembers          Int           @default(1)
  estimatedPricePerPerson String
  currency                String        @default("USD")
  totalBookingValue       Float         @default(0)
  included                String[]
  bookingDeadline         DateTime?
  cancellationPolicy      String?
  status                  String        @default("draft")
  isActive                Boolean       @default(true)
  visibility              String        @default("public")
  tags                    String[]
  category                String?       @default("adventure")
  difficulty              String?       @default("moderate")
  featured                Boolean       @default(false)
  trending                Boolean       @default(false)
  views                   Int           @default(0)
  applications            Int           @default(0)
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  members                 GroupMember[]
  creator                 User          @relation("TripCreator", fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId])
  @@index([slug])
  @@index([status, visibility])
  @@index([startDate])
  @@index([destination])
  @@index([featured, trending])
  @@map("trip_groups")
}

model GroupMember {
  id              String    @id @default(cuid())
  tripGroupId     String
  userId          String
  role            String    @default("member")
  status          String    @default("pending")
  joinedAt        DateTime  @default(now())
  confirmedAt     DateTime?
  paymentStatus   String    @default("pending")
  paymentIntentId String?
  amountPaid      Float?
  paidAt          DateTime?
  customizations  Json?
  tripGroup       TripGroup @relation(fields: [tripGroupId], references: [id], onDelete: Cascade)
  user            User      @relation("GroupMemberships", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tripGroupId, userId])
  @@index([tripGroupId, status])
  @@index([userId])
  @@index([status])
  @@map("group_members")
}

model TripMatchUserProfile {
  id                 String           @id @default(cuid())
  userId             String           @unique
  displayName        String?
  bio                String?
  avatarUrl          String?
  coverImageUrl      String?
  travelStyle        String[]
  interests          String[]
  languagesSpoken    String[]
  ageRange           String?
  gender             String?
  locationCity       String?
  locationCountry    String?
  emailVerified      Boolean          @default(false)
  phoneVerified      Boolean          @default(false)
  idVerified         Boolean          @default(false)
  safetyScore        Int              @default(0)
  verificationLevel  Int              @default(0)
  tripsCreated       Int              @default(0)
  tripsJoined        Int              @default(0)
  tripsCompleted     Int              @default(0)
  totalCompanionsMet Int              @default(0)
  avgRating          Float            @default(0)
  totalReviews       Int              @default(0)
  personalityVector  Float[]
  settings           Json?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  postComments       PostComment[]
  postReactions      PostReaction[]
  matchesFrom        TravelerMatch[]  @relation("MatchFrom")
  matchesTo          TravelerMatch[]  @relation("MatchTo")
  messages           TripMessage[]
  posts              TripPost[]
  reviewsReceived    TripReview[]     @relation("ReviewsReceived")
  reviewsGiven       TripReview[]     @relation("ReviewsGiven")
  user               User             @relation("TripMatchProfile", fields: [userId], references: [id], onDelete: Cascade)
  connectionsFrom    UserConnection[] @relation("ConnectionFrom")
  connectionsTo      UserConnection[] @relation("ConnectionTo")

  @@index([userId])
  @@index([locationCountry])
  @@index([verificationLevel])
  @@map("tripmatch_user_profiles")
}

model TripPost {
  id             String               @id @default(cuid())
  tripId         String
  userId         String
  content        String?
  mediaUrls      String[]
  mediaType      String?
  location       String?
  locationLat    Float?
  locationLng    Float?
  reactionsCount Int                  @default(0)
  commentsCount  Int                  @default(0)
  visibility     String               @default("group")
  postType       String               @default("update")
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  comments       PostComment[]
  reactions      PostReaction[]
  profile        TripMatchUserProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([tripId, createdAt])
  @@index([userId])
  @@index([visibility])
  @@map("trip_posts")
}

model PostReaction {
  id           String               @id @default(cuid())
  postId       String
  userId       String
  reactionType String
  createdAt    DateTime             @default(now())
  post         TripPost             @relation(fields: [postId], references: [id], onDelete: Cascade)
  profile      TripMatchUserProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@map("post_reactions")
}

model PostComment {
  id        String               @id @default(cuid())
  postId    String
  userId    String
  content   String
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  post      TripPost             @relation(fields: [postId], references: [id], onDelete: Cascade)
  profile   TripMatchUserProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([postId, createdAt])
  @@index([userId])
  @@map("post_comments")
}

model TripMessage {
  id              String               @id @default(cuid())
  tripId          String
  userId          String
  message         String
  messageType     String               @default("text")
  attachments     String[]
  isSystemMessage Boolean              @default(false)
  systemEvent     String?
  readBy          String[]
  createdAt       DateTime             @default(now())
  profile         TripMatchUserProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([tripId, createdAt])
  @@index([userId])
  @@map("trip_messages")
}

model TripReview {
  id                  String               @id @default(cuid())
  tripId              String
  reviewerId          String
  reviewedUserId      String
  overallRating       Int
  communicationRating Int?
  reliabilityRating   Int?
  friendlinessRating  Int?
  reviewText          String?
  isPublic            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  reviewedUser        TripMatchUserProfile @relation("ReviewsReceived", fields: [reviewedUserId], references: [userId], onDelete: Cascade)
  reviewer            TripMatchUserProfile @relation("ReviewsGiven", fields: [reviewerId], references: [userId], onDelete: Cascade)

  @@unique([tripId, reviewerId, reviewedUserId])
  @@index([tripId])
  @@index([reviewerId])
  @@index([reviewedUserId])
  @@map("trip_reviews")
}

model UserConnection {
  id         String               @id @default(cuid())
  fromUserId String
  toUserId   String
  status     String               @default("pending")
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
  fromUser   TripMatchUserProfile @relation("ConnectionFrom", fields: [fromUserId], references: [userId], onDelete: Cascade)
  toUser     TripMatchUserProfile @relation("ConnectionTo", fields: [toUserId], references: [userId], onDelete: Cascade)

  @@unique([fromUserId, toUserId])
  @@index([fromUserId, status])
  @@index([toUserId, status])
  @@map("user_connections")
}

model TravelerMatch {
  id            String               @id @default(cuid())
  fromUserId    String
  toUserId      String
  matchScore    Float                @default(0)
  matchReasons  String[]
  action        String?
  actionTaken   Boolean              @default(false)
  matchMetadata Json?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  fromUser      TripMatchUserProfile @relation("MatchFrom", fields: [fromUserId], references: [userId], onDelete: Cascade)
  toUser        TripMatchUserProfile @relation("MatchTo", fields: [toUserId], references: [userId], onDelete: Cascade)

  @@unique([fromUserId, toUserId])
  @@index([fromUserId, actionTaken])
  @@index([toUserId])
  @@index([matchScore])
  @@map("traveler_matches")
}

model AnalyticsEvent {
  id        String   @id @default(cuid())
  userId    String?
  sessionId String
  eventType String
  eventData Json
  url       String?
  referrer  String?
  userAgent String?
  ipAddress String?
  timestamp DateTime @default(now())

  @@index([eventType, timestamp])
  @@index([userId, timestamp])
  @@index([sessionId, timestamp])
  @@index([timestamp])
  @@map("analytics_events")
}

model MetricSnapshot {
  id          String   @id @default(cuid())
  metricName  String
  value       Float
  dimensions  Json
  timestamp   DateTime @default(now())
  granularity String

  @@unique([metricName, granularity, timestamp])
  @@index([metricName, timestamp])
  @@index([timestamp, granularity])
  @@map("metric_snapshots")
}

model PricePrediction {
  id              String   @id @default(cuid())
  origin          String
  destination     String
  departDate      String
  returnDate      String?
  predictedPrice  Float
  confidence      Float
  priceRange      Json
  modelVersion    String
  features        Json
  recommendation  String?
  savingsEstimate Float?
  createdAt       DateTime @default(now())
  expiresAt       DateTime

  @@index([origin, destination, departDate])
  @@index([createdAt])
  @@map("price_predictions")
}

model MLModel {
  id           String    @id @default(cuid())
  name         String    @unique
  version      String
  modelType    String
  accuracy     Float?
  metrics      Json
  trainedAt    DateTime
  trainingData Json
  features     String[]
  active       Boolean   @default(false)
  deployedAt   DateTime?
  createdAt    DateTime  @default(now())

  @@index([name, version])
  @@index([active])
  @@map("ml_models")
}

model FeatureFlag {
  id                String                    @id @default(cuid())
  key               String                    @unique
  name              String
  description       String?
  enabled           Boolean                   @default(false)
  rolloutPercentage Int                       @default(0)
  targetSegments    Json?
  variants          Json
  isExperiment      Boolean                   @default(false)
  experimentStatus  String?
  successMetric     String?
  minimumSampleSize Int?
  experimentResults Json?
  winningVariant    String?
  createdAt         DateTime                  @default(now())
  updatedAt         DateTime                  @updatedAt
  startedAt         DateTime?
  completedAt       DateTime?
  participations    ExperimentParticipation[]

  @@index([key])
  @@index([enabled])
  @@index([isExperiment, experimentStatus])
  @@map("feature_flags")
}

model ExperimentParticipation {
  id              String      @id @default(cuid())
  flagId          String
  userId          String?
  sessionId       String
  variant         String
  assignedAt      DateTime    @default(now())
  converted       Boolean     @default(false)
  convertedAt     DateTime?
  conversionValue Float?
  flag            FeatureFlag @relation(fields: [flagId], references: [id], onDelete: Cascade)

  @@unique([flagId, userId])
  @@unique([flagId, sessionId])
  @@index([flagId, variant])
  @@index([flagId, converted])
  @@map("experiment_participations")
}

model PerformanceMetric {
  id             String   @id @default(cuid())
  metricName     String
  value          Float
  rating         String
  url            String
  userId         String?
  sessionId      String
  deviceType     String?
  browser        String?
  browserVersion String?
  os             String?
  connectionType String?
  timestamp      DateTime @default(now())

  @@index([metricName, timestamp])
  @@index([url, metricName])
  @@index([rating, metricName])
  @@index([timestamp])
  @@map("performance_metrics")
}

model ErrorLog {
  id          String    @id @default(cuid())
  message     String
  stack       String?
  errorType   String?
  url         String
  userId      String?
  sessionId   String
  userAgent   String?
  browser     String?
  os          String?
  severity    String
  resolved    Boolean   @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?
  notes       String?
  fingerprint String?
  count       Int       @default(1)
  timestamp   DateTime  @default(now())

  @@index([timestamp(sort: Desc)])
  @@index([severity, resolved, timestamp(sort: Desc)])
  @@index([fingerprint, timestamp])
  @@index([userId])
  @@map("error_logs")
}

model ConversionFunnel {
  id        String   @id @default(cuid())
  sessionId String
  userId    String?
  stage     String
  action    String
  metadata  Json?
  duration  Int?
  timestamp DateTime @default(now())

  @@index([sessionId, stage])
  @@index([stage, action, timestamp])
  @@index([timestamp])
  @@map("conversion_funnels")
}

model UserCohort {
  id            String   @id @default(cuid())
  userId        String   @unique
  cohortDate    DateTime
  cohortWeek    String
  cohortMonth   String
  lastActiveAt  DateTime
  day1Retained  Boolean  @default(false)
  day7Retained  Boolean  @default(false)
  day30Retained Boolean  @default(false)
  totalSessions Int      @default(0)
  totalSearches Int      @default(0)
  totalBookings Int      @default(0)
  lifetimeValue Float    @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([cohortDate])
  @@index([cohortWeek])
  @@index([cohortMonth])
  @@map("user_cohorts")
}

model AdminUser {
  id          String   @id @default(cuid())
  userId      String   @unique
  role        String
  permissions Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([role])
  @@map("admin_users")
}

model AuditLog {
  id           String   @id @default(cuid())
  userId       String
  userEmail    String
  userRole     String
  action       String
  resource     String
  resourceId   String
  changes      Json?
  ipAddress    String?
  userAgent    String?
  requestId    String?
  success      Boolean  @default(true)
  errorMessage String?
  timestamp    DateTime @default(now())

  @@index([userId, timestamp])
  @@index([resource, resourceId])
  @@index([timestamp])
  @@index([action, resource])
  @@map("audit_logs")
}

model Deal {
  id              String    @id @default(cuid())
  slug            String    @unique
  title           String
  description     String
  destination     Json
  origin          String
  originalPrice   Float
  discountedPrice Float
  currency        String    @default("USD")
  flightDetails   Json
  dealScore       Int       @default(50)
  featured        Boolean   @default(false)
  active          Boolean   @default(true)
  expiresAt       DateTime?
  category        String    @default("featured")
  tags            String[]
  images          Json
  restrictions    String[]
  seo             Json
  views           Int       @default(0)
  clicks          Int       @default(0)
  conversions     Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  createdBy       String

  @@index([slug])
  @@index([active, featured])
  @@index([expiresAt])
  @@index([category])
  @@map("deals")
}

model Destination {
  id               String   @id @default(cuid())
  slug             String   @unique
  airportCode      String   @unique
  city             String
  country          String
  region           String
  description      String
  shortDescription String
  highlights       String[]
  travelInfo       Json
  priceRange       String
  avgPrice         Float?
  travelStyles     String[]
  images           Json
  seo              Json
  published        Boolean  @default(false)
  featured         Boolean  @default(false)
  trending         Boolean  @default(false)
  views            Int      @default(0)
  searches         Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([slug])
  @@index([airportCode])
  @@index([published, featured])
  @@index([trending])
  @@map("destinations")
}

model EmailTemplate {
  id              String    @id @default(cuid())
  name            String    @unique
  key             String    @unique
  subject         String
  preheader       String?
  body            String
  variables       Json
  layout          String    @default("default")
  brandColor      String    @default("#3b82f6")
  headerImage     String?
  footerText      String    @default("Â© 2025 Fly2Any. All rights reserved.")
  active          Boolean   @default(true)
  lastTested      DateTime?
  testRecipients  String[]
  testsSent       Int       @default(0)
  lastTestResults Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([key])
  @@index([active])
  @@map("email_templates")
}

model EmailCampaign {
  id              String    @id @default(cuid())
  name            String
  type            String    @default("promotional")
  status          String    @default("draft")
  subject         String
  preheader       String?
  body            String
  plainText       String?
  templateId      String?
  targetAudience  String    @default("all")
  customFilter    Json?
  excludeList     String[]
  scheduledAt     DateTime?
  startedAt       DateTime?
  completedAt     DateTime?
  totalRecipients Int       @default(0)
  sent            Int       @default(0)
  delivered       Int       @default(0)
  opened          Int       @default(0)
  clicked         Int       @default(0)
  bounced         Int       @default(0)
  unsubscribed    Int       @default(0)
  complained      Int       @default(0)
  createdBy       String?
  tags            String[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([status])
  @@index([type])
  @@index([scheduledAt])
  @@map("email_campaigns")
}

model EmailCampaignSend {
  id           String    @id @default(cuid())
  campaignId   String
  email        String
  status       String    @default("pending")
  messageId    String?
  sentAt       DateTime?
  deliveredAt  DateTime?
  openedAt     DateTime?
  clickedAt    DateTime?
  bouncedAt    DateTime?
  errorMessage String?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@unique([campaignId, email])
  @@index([campaignId])
  @@index([email])
  @@index([status])
  @@map("email_campaign_sends")
}

model HealthCheck {
  id           String   @id @default(cuid())
  service      String
  status       String
  responseTime Float?
  errorMessage String?
  metadata     Json?
  timestamp    DateTime @default(now())

  @@index([service, timestamp])
  @@index([status, timestamp])
  @@map("health_checks")
}

model SearchSuggestion {
  id         String   @id @default(cuid())
  query      String   @unique
  type       String
  code       String?
  name       String
  country    String?
  popularity Int      @default(0)
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([query])
  @@index([type, popularity])
  @@map("search_suggestions")
}

model HotelBooking {
  id                    String        @id @default(cuid())
  confirmationNumber    String        @unique
  userId                String?
  hotelId               String
  hotelName             String
  hotelAddress          String?
  hotelCity             String?
  hotelCountry          String?
  hotelPhone            String?
  hotelEmail            String?
  hotelImages           Json?
  roomId                String
  roomName              String
  roomDescription       String?
  bedType               String?
  maxGuests             Int           @default(2)
  roomAmenities         String[]
  checkInDate           DateTime
  checkOutDate          DateTime
  nights                Int
  pricePerNight         Decimal       @db.Decimal(10, 2)
  subtotal              Decimal       @db.Decimal(10, 2)
  taxesAndFees          Decimal       @db.Decimal(10, 2)
  totalPrice            Decimal       @db.Decimal(10, 2)
  currency              String        @default("USD")
  guestTitle            String?
  guestFirstName        String
  guestLastName         String
  guestEmail            String
  guestPhone            String
  guestDateOfBirth      DateTime?
  additionalGuests      Json?
  specialRequests       String?
  paymentStatus         String        @default("pending")
  paymentIntentId       String?       @unique
  paymentMethodId       String?
  paymentProvider       String        @default("stripe")
  paidAt                DateTime?
  refundedAt            DateTime?
  refundAmount          Decimal?      @db.Decimal(10, 2)
  refundReason          String?
  status                String        @default("pending")
  cancellationPolicy    String?
  cancellable           Boolean       @default(true)
  cancelledAt           DateTime?
  cancellationReason    String?
  mealPlan              String?
  mealPlanIncluded      Boolean       @default(false)
  provider              String        @default("duffel")
  providerBookingId     String?
  providerData          Json?
  confirmationEmailSent Boolean       @default(false)
  confirmationSentAt    DateTime?
  reminderEmailSent     Boolean       @default(false)
  reminderSentAt        DateTime?
  source                String?
  deviceType            String?
  userAgent             String?
  ipAddress             String?
  notes                 String?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  reviews               HotelReview[]

  @@index([userId])
  @@index([guestEmail])
  @@index([confirmationNumber])
  @@index([status])
  @@index([checkInDate])
  @@index([checkOutDate])
  @@index([paymentStatus])
  @@index([createdAt])
  @@map("hotel_bookings")
}

model HotelReview {
  id            String       @id @default(cuid())
  bookingId     String
  userId        String?
  hotelId       String
  hotelName     String
  overallRating Int
  cleanliness   Int?
  comfort       Int?
  location      Int?
  facilities    Int?
  staff         Int?
  valueForMoney Int?
  title         String
  review        String
  photos        String[]
  travelType    String?
  stayDate      DateTime
  roomType      String?
  reviewerName  String
  reviewerEmail String?
  verified      Boolean      @default(false)
  status        String       @default("pending")
  moderatedAt   DateTime?
  moderatedBy   String?
  helpful       Int          @default(0)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  booking       HotelBooking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([hotelId, status])
  @@index([userId])
  @@index([bookingId])
  @@index([status])
  @@index([createdAt])
  @@map("hotel_reviews")
}

model HotelPriceAlert {
  id                String    @id @default(cuid())
  userId            String
  hotelId           String
  hotelName         String
  location          String
  checkInDate       DateTime
  checkOutDate      DateTime
  nights            Int
  currentPrice      Float
  targetPrice       Float
  currency          String    @default("USD")
  roomType          String?
  guests            Int       @default(2)
  active            Boolean   @default(true)
  triggered         Boolean   @default(false)
  lastChecked       DateTime  @default(now())
  triggeredAt       DateTime?
  emailNotification Boolean   @default(true)
  lastNotifiedAt    DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([userId, active])
  @@index([hotelId, active])
  @@index([active, lastChecked])
  @@map("hotel_price_alerts")
}

model Affiliate {
  id                       String              @id @default(cuid())
  userId                   String              @unique
  businessName             String?
  website                  String?
  taxId                    String?
  description              String?
  tier                     String              @default("starter")
  status                   String              @default("pending")
  category                 String              @default("standard")
  creatorProfile           Json?
  channelVerified          Boolean             @default(false)
  channelVerifiedAt        DateTime?
  channelVerifiedBy        String?
  customCommissionEnabled  Boolean             @default(false)
  customFlightCommission   Float?
  customHotelCommission    Float?
  customPackageCommission  Float?
  customCarCommission      Float?
  customActivityCommission Float?
  volumeBonusEnabled       Boolean             @default(false)
  volumeBonusThreshold     Int?
  volumeBonusRate          Float?
  performanceBonusEnabled  Boolean             @default(false)
  performanceBonusTarget   Float?
  performanceBonusRate     Float?
  exclusivityBonusEnabled  Boolean             @default(false)
  exclusivityBonusRate     Float?
  exclusivityAgreedAt      DateTime?
  exclusivityEndsAt        DateTime?
  hasCustomLandingPage     Boolean             @default(false)
  customLandingPageSlug    String?             @unique
  hasBrandedLinks          Boolean             @default(false)
  brandedDomain            String?
  hasApiAccess             Boolean             @default(false)
  apiKey                   String?             @unique
  apiKeyLastUsed           DateTime?
  apiCallsThisMonth        Int                 @default(0)
  apiCallsLimit            Int                 @default(10000)
  hasDedicatedAM           Boolean             @default(false)
  accountManagerId         String?
  accountManagerEmail      String?
  hasPrioritySupport       Boolean             @default(false)
  hasEarlyDealAccess       Boolean             @default(false)
  coMarketingEnabled       Boolean             @default(false)
  featuredOnWebsite        Boolean             @default(false)
  trustLevel               String              @default("new")
  successfulBookingsCount  Int                 @default(0)
  failedBookingsCount      Int                 @default(0)
  trustScore               Float               @default(50)
  customHoldPeriod         Int?
  topPerformingContent     Json?
  platformMetrics          Json?
  metricsLastUpdated       DateTime?
  totalClicks              Int                 @default(0)
  totalReferrals           Int                 @default(0)
  completedTrips           Int                 @default(0)
  canceledBookings         Int                 @default(0)
  refundedBookings         Int                 @default(0)
  totalCustomerSpend       Float               @default(0)
  totalYourProfit          Float               @default(0)
  totalCommissionsEarned   Float               @default(0)
  totalCommissionsPaid     Float               @default(0)
  monthlyCompletedTrips    Int                 @default(0)
  monthlyRevenue           Float               @default(0)
  monthlyCommissions       Float               @default(0)
  monthStatsLastReset      DateTime            @default(now())
  currentBalance           Float               @default(0)
  pendingBalance           Float               @default(0)
  lifetimeEarnings         Float               @default(0)
  lifetimePaid             Float               @default(0)
  minPayoutThreshold       Float               @default(50)
  payoutMethod             String              @default("paypal")
  payoutEmail              String?
  payoutDetails            Json?
  referralCode             String              @unique
  trackingId               String              @unique
  customLandingPage        String?
  customBranding           Json?
  emailNotifications       Boolean             @default(true)
  weeklyReports            Boolean             @default(true)
  monthlyStatements        Boolean             @default(true)
  adminNotes               String?
  reviewedBy               String?
  reviewedAt               DateTime?
  approvedAt               DateTime?
  suspendedAt              DateTime?
  suspensionReason         String?
  bannedAt                 DateTime?
  banReason                String?
  createdAt                DateTime            @default(now())
  updatedAt                DateTime            @updatedAt
  referrals                AffiliateReferral[]
  user                     User                @relation("UserAffiliate", fields: [userId], references: [id], onDelete: Cascade)
  commissions              Commission[]
  flatFeeCampaigns         FlatFeeCampaign[]
  payouts                  Payout[]

  @@index([tier, status])
  @@index([status])
  @@index([category])
  @@index([referralCode])
  @@index([trackingId])
  @@index([monthlyCompletedTrips])
  @@index([trustLevel])
  @@map("affiliates")
}

model AffiliateReferral {
  id           String      @id @default(cuid())
  affiliateId  String
  clickId      String      @unique
  ipAddress    String
  userAgent    String
  referrerUrl  String?
  landingPage  String
  utmSource    String?
  utmMedium    String?
  utmCampaign  String?
  utmTerm      String?
  utmContent   String?
  deviceType   String?
  browser      String?
  os           String?
  country      String?
  city         String?
  userId       String?
  bookingId    String?
  cookieSet    Boolean     @default(true)
  cookieExpiry DateTime
  clickedAt    DateTime    @default(now())
  signedUpAt   DateTime?
  bookedAt     DateTime?
  convertedAt  DateTime?
  completedAt  DateTime?
  status       String      @default("click")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  affiliate    Affiliate   @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  commission   Commission?

  @@index([affiliateId, status])
  @@index([clickId])
  @@index([bookingId])
  @@index([cookieExpiry])
  @@index([clickedAt])
  @@map("affiliate_referrals")
}

model Commission {
  id                      String            @id @default(cuid())
  affiliateId             String
  referralId              String            @unique
  bookingId               String            @unique
  userId                  String
  bookingType             String
  productDetails          Json
  revenueModel            String
  customerTotalPaid       Float
  supplierCost            Float
  yourGrossProfit         Float
  affiliateTierAtBooking  String
  commissionRate          Float
  commissionAmount        Float
  minPayoutApplied        Boolean           @default(false)
  maxPayoutApplied        Boolean           @default(false)
  cappedAmount            Float?
  bookingDate             DateTime
  tripStartDate           DateTime
  tripEndDate             DateTime
  tripStartedAt           DateTime?
  tripCompletedAt         DateTime?
  status                  String            @default("pending")
  /// *
  ///    * Enhanced Status Flow:
  ///    * - 'pending': Booking created, waiting for trip
  ///    * - 'trip_in_progress': Trip started
  ///    * - 'trip_completed': Trip finished successfully
  ///    * - 'in_hold_period': Waiting for hold period to expire
  ///    * - 'available': Ready for payout
  ///    * - 'payout_requested': Included in payout request
  ///    * - 'payout_approved': Admin approved payout
  ///    * - 'paid': Money sent
  ///    * - 'cancelled': Booking cancelled before trip
  ///    * - 'reversed': Refunded after payout (clawback)
  statusHistory           Json?
  holdPeriodDays          Int               @default(30)
  holdPeriodEndsAt        DateTime?
  releasedAt              DateTime?
  cancelledAt             DateTime?
  cancelReason            String?
  refundedAt              DateTime?
  refundAmount            Float?
  refundReason            String?
  isFraud                 Boolean           @default(false)
  fraudDetectedAt         DateTime?
  fraudNotes              String?
  baseCommissionRate      Float
  baseCommissionAmount    Float
  volumeBonusApplied      Boolean           @default(false)
  volumeBonusAmount       Float             @default(0)
  performanceBonusApplied Boolean           @default(false)
  performanceBonusAmount  Float             @default(0)
  exclusivityBonusApplied Boolean           @default(false)
  exclusivityBonusAmount  Float             @default(0)
  totalCommissionAmount   Float
  contentSource           String?
  contentUrl              String?
  contentTitle            String?
  utmCampaign             String?
  utmSource               String?
  utmMedium               String?
  utmContent              String?
  approvedAt              DateTime?
  paidAt                  DateTime?
  payoutId                String?
  reversed                Boolean           @default(false)
  reversedAt              DateTime?
  reversalReason          String?
  reversalAmount          Float?
  adminNotes              String?
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
  affiliate               Affiliate         @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  payout                  Payout?           @relation(fields: [payoutId], references: [id])
  referral                AffiliateReferral @relation(fields: [referralId], references: [id])

  @@index([affiliateId, status])
  @@index([bookingId])
  @@index([status])
  @@index([status, holdPeriodEndsAt])
  @@index([tripEndDate])
  @@index([holdPeriodEndsAt])
  @@index([approvedAt])
  @@map("commissions")
}

model Payout {
  id                  String       @id @default(cuid())
  affiliateId         String
  amount              Float
  commissionCount     Int
  periodStart         DateTime
  periodEnd           DateTime
  method              String
  paymentEmail        String?
  bankDetails         Json?
  transactionId       String?
  status              String       @default("pending")
  processedAt         DateTime?
  completedAt         DateTime?
  failedAt            DateTime?
  failureReason       String?
  processingFee       Float        @default(0)
  netAmount           Float
  currency            String       @default("USD")
  invoiceNumber       String?      @unique
  receiptUrl          String?
  processedBy         String?
  adminNotes          String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  commissionsIncluded Commission[]
  affiliate           Affiliate    @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([affiliateId, status])
  @@index([status])
  @@index([periodStart, periodEnd])
  @@index([processedAt])
  @@map("payouts")
}

model AffiliateActivityLog {
  id           String   @id @default(cuid())
  affiliateId  String
  activityType String
  description  String
  metadata     Json?
  performedBy  String?
  ipAddress    String?
  createdAt    DateTime @default(now())

  @@index([affiliateId, createdAt])
  @@index([activityType])
  @@map("affiliate_activity_logs")
}

model FlatFeeCampaign {
  id                 String    @id @default(cuid())
  affiliateId        String
  campaignName       String
  campaignType       String
  platform           String
  contentType        String
  deliverables       String
  flatFeeAmount      Float
  currency           String    @default("USD")
  includesCommission Boolean   @default(true)
  commissionRate     Float?
  status             String    @default("draft")
  proposedAt         DateTime?
  approvedAt         DateTime?
  approvedBy         String?
  startDate          DateTime?
  dueDate            DateTime?
  completedAt        DateTime?
  deliveryProof      Json?
  reviewedAt         DateTime?
  reviewedBy         String?
  reviewNotes        String?
  paidAt             DateTime?
  paidBy             String?
  paymentMethod      String?
  invoiceNumber      String?   @unique
  trackingUrl        String?
  clicks             Int       @default(0)
  conversions        Int       @default(0)
  revenue            Float     @default(0)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  affiliate          Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([affiliateId, status])
  @@index([status])
  @@map("flat_fee_campaigns")
}

model HoldPeriodConfig {
  id                    String   @id @default(cuid())
  category              String
  trustLevel            String
  holdPeriodDays        Int
  minSuccessfulBookings Int?
  minTrustScore         Float?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@unique([category, trustLevel])
  @@map("hold_period_configs")
}

model CommissionLifecycleLog {
  id           String   @id @default(cuid())
  commissionId String
  fromStatus   String
  toStatus     String
  changedAt    DateTime @default(now())
  reason       String?
  changedBy    String?
  automated    Boolean  @default(true)
  metadata     Json?

  @@index([commissionId])
  @@index([commissionId, changedAt])
  @@map("commission_lifecycle_logs")
}

model TravelAgent {
  id                     String                   @id @default(cuid())
  userId                 String                   @unique
  agencyName             String?
  businessName           String?
  company                String?
  iataNumber             String?                  @unique
  arcNumber              String?
  licenseNumber          String?
  businessType           String?
  logo                   String?
  brandColor             String?
  customDomain           String?                  @unique
  emailSignature         String?
  tier                   AgentTier                @default(INDEPENDENT)
  status                 AgentStatus              @default(PENDING)
  isTestAccount          Boolean                  @default(false)
  defaultCommission      Float                    @default(0.05)
  commissionModel        CommissionModel          @default(PERCENTAGE)
  flightCommission       Float?
  hotelCommission        Float?
  activityCommission     Float?
  transferCommission     Float?
  insuranceCommission    Float?
  carRentalCommission    Float?
  firstName              String?
  lastName               String?
  email                  String?
  phone                  String?
  website                String?
  phoneNumber            String?
  address                String?
  city                   String?
  state                  String?
  country                String?
  zipCode                String?
  timezone               String?
  operatingHours         Json?
  totalSales             Float                    @default(0)
  totalCommissions       Float                    @default(0)
  quotesSent             Int                      @default(0)
  quotesAccepted         Int                      @default(0)
  conversionRate         Float                    @default(0)
  avgDealSize            Float                    @default(0)
  clientSatisfaction     Float?
  responseTime           Int?
  bookingsThisMonth      Int                      @default(0)
  revenueThisMonth       Float                    @default(0)
  monthStatsResetAt      DateTime                 @default(now())
  hasClientPortal        Boolean                  @default(false)
  hasTeamManagement      Boolean                  @default(false)
  hasAdvancedAnalytics   Boolean                  @default(false)
  hasWhiteLabel          Boolean                  @default(false)
  hasApiAccess           Boolean                  @default(false)
  hasPrioritySupport     Boolean                  @default(false)
  hasCustomBranding      Boolean                  @default(false)
  hasSmsNotifications    Boolean                  @default(false)
  hasWhatsappIntegration Boolean                  @default(false)
  apiKey                 String?                  @unique
  apiKeyCreatedAt        DateTime?
  apiCallsLimit          Int                      @default(1000)
  apiCallsUsed           Int                      @default(0)
  maxClients             Int                      @default(50)
  maxActiveQuotes        Int                      @default(100)
  maxTeamMembers         Int                      @default(1)
  maxMonthlyBookings     Int                      @default(999999)
  minPayoutThreshold     Float                    @default(100)
  payoutMethod           String                   @default("stripe")
  payoutSchedule         String                   @default("monthly")
  payoutEmail            String?
  stripeAccountId        String?                  @unique
  bankDetails            Json?
  currentBalance         Float                    @default(0)
  availableBalance       Float                    @default(0)
  pendingBalance         Float                    @default(0)
  lifetimeEarnings       Float                    @default(0)
  lifetimePaid           Float                    @default(0)
  emailNotifications     Boolean                  @default(true)
  quoteAcceptedEmail     Boolean                  @default(true)
  paymentReceivedEmail   Boolean                  @default(true)
  clientMessageEmail     Boolean                  @default(true)
  weeklyReports          Boolean                  @default(true)
  monthlyStatements      Boolean                  @default(true)
  smsNotifications       Boolean                  @default(false)
  onboardingCompleted    Boolean                  @default(false)
  onboardingStep         Int                      @default(0)
  verified               Boolean                  @default(false)
  verifiedAt             DateTime?
  verifiedBy             String?
  verificationDocuments  Json?
  adminNotes             String?
  accountManager         String?
  reviewedBy             String?
  reviewedAt             DateTime?
  approvedAt             DateTime?
  suspendedAt            DateTime?
  suspensionReason       String?
  bannedAt               DateTime?
  banReason              String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  lastLoginAt            DateTime?
  activityLogs           AgentActivityLog[]
  bookings               AgentBooking[]
  clients                AgentClient[]
  commissions            AgentCommission[]
  templates              AgentItineraryTemplate[]
  payouts                AgentPayout[]
  products               AgentProduct[]           @relation("AgentProducts")
  quotes                 AgentQuote[]
  suppliers              AgentSupplier[]          @relation("AgentSuppliers")
  team                   AgentTeamMember[]        @relation("AgencyTeam")
  memberOf               AgentTeamMember[]        @relation("AgentMemberships")
  markupRules            AgencyMarkupRule[]       @relation("AgencyMarkupRules")
  quoteTemplates         QuoteTemplate[]          @relation("AgentQuoteTemplates")
  quoteAnalytics         QuoteAnalytics[]         @relation("AgentQuoteAnalytics")
  quoteComparisons       QuoteComparison[]        @relation("AgentQuoteComparisons")
  user                   User                     @relation("UserTravelAgent", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tier, status])
  @@index([status])
  @@index([userId])
  @@index([bookingsThisMonth])
  @@map("travel_agents")
}

model AgencyMarkupRule {
  id                String      @id @default(cuid())
  agencyId          String
  name              String
  description       String?
  productType       String?     // FLIGHT, HOTEL, ACTIVITY, TRANSFER, ALL
  minPrice          Float?
  maxPrice          Float?
  minMarkup         Float       @default(5)
  maxMarkup         Float       @default(50)
  suggestedMarkup   Float       @default(15)
  appliesToAll      Boolean     @default(true)
  agentIds          String[]
  priority          Int         @default(0)
  active            Boolean     @default(true)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  agency            TravelAgent @relation("AgencyMarkupRules", fields: [agencyId], references: [id], onDelete: Cascade)

  @@index([agencyId, active])
  @@map("agency_markup_rules")
}

model AgentClient {
  id                    String                @id @default(cuid())
  agentId               String
  userId                String?               @unique
  firstName             String
  lastName              String
  email                 String
  phone                 String?
  company               String?
  dateOfBirth           DateTime?
  anniversary           DateTime?
  preferredLanguage     String?               @default("en")
  nationality           String?
  address               String?
  city                  String?
  state                 String?
  country               String?
  zipCode               String?
  cabinClass            String?
  preferredAirlines     String[]
  homeAirport           String?
  seatPreference        String?
  mealPreference        String?
  specialNeeds          String?
  dietaryRestrictions   String[]
  frequentFlyerPrograms Json?
  hotelLoyaltyPrograms  Json?
  carRentalPrograms     Json?
  passportNumber        String?
  passportExpiry        DateTime?
  passportCountry       String?
  visas                 Json?
  tsaPrecheck           Boolean               @default(false)
  globalEntry           Boolean               @default(false)
  knownTravelerNumber   String?
  redressNumber         String?
  budgetRange           String?
  tripTypes             String[]
  favoriteDestinations  String[]
  travelStyle           String?
  preferredChannel      String?
  bestTimeToContact     String?
  doNotDisturb          Boolean               @default(false)
  segment               ClientSegment         @default(STANDARD)
  tags                  String[]
  vipLevel              Int                   @default(0)
  priority              String                @default("normal")
  source                String?
  referredBy            String?
  lifetimeValue         Float                 @default(0)
  totalBookings         Int                   @default(0)
  totalSpent            Float                 @default(0)
  avgBookingValue       Float                 @default(0)
  lastBookingDate       DateTime?
  nextBookingDate       DateTime?
  lastContactDate       DateTime?
  status                ClientStatus          @default(ACTIVE)
  isVip                 Boolean               @default(false)
  blacklisted           Boolean               @default(false)
  blacklistReason       String?
  notes                 String?
  internalNotes         String?
  communicationLog      Json?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  deletedAt             DateTime?
  bookings              AgentBooking[]
  documents             AgentClientDocument[]
  clientNotes           AgentClientNote[]
  agent                 TravelAgent           @relation(fields: [agentId], references: [id], onDelete: Cascade)
  user                  User?                 @relation("UserAgentClient", fields: [userId], references: [id])
  quotes                AgentQuote[]
  quoteComparisons      QuoteComparison[]     @relation("ClientQuoteComparisons")

  @@unique([agentId, email])
  @@index([agentId])
  @@index([agentId, segment])
  @@index([email])
  @@index([status])
  @@map("agent_clients")
}

model AgentQuote {
  id                     String        @id @default(cuid())
  quoteNumber            String        @unique
  agentId                String
  clientId               String
  tripName               String
  destination            String
  startDate              DateTime
  endDate                DateTime
  duration               Int
  travelers              Int
  adults                 Int           @default(1)
  children               Int           @default(0)
  infants                Int           @default(0)
  flights                Json[]
  hotels                 Json[]
  activities             Json[]
  transfers              Json[]
  carRentals             Json[]
  insurance              Json?
  customItems            Json[]
  flightsCost            Float         @default(0)
  hotelsCost             Float         @default(0)
  activitiesCost         Float         @default(0)
  transfersCost          Float         @default(0)
  carRentalsCost         Float         @default(0)
  insuranceCost          Float         @default(0)
  customItemsCost        Float         @default(0)
  subtotal               Float
  agentMarkup            Float
  agentMarkupPercent     Float?
  taxes                  Float         @default(0)
  fees                   Float         @default(0)
  discount               Float         @default(0)
  total                  Float
  currency               String        @default("USD")
  showCommissionToClient Boolean       @default(false)
  commissionLabel        String?
  hideMarkupBreakdown    Boolean       @default(true)
  version                Int           @default(1)
  versionName            String?
  parentQuoteId          String?
  isAlternative          Boolean       @default(false)
  status                 QuoteStatus   @default(DRAFT)
  expiresAt              DateTime
  sentAt                 DateTime?
  viewedAt               DateTime?
  viewCount              Int           @default(0)
  lastViewedAt           DateTime?
  acceptedAt             DateTime?
  declinedAt             DateTime?
  declineReason          String?
  clientFeedback         String?
  modificationRequests   String?
  agentNotes             String?
  notes                  String?
  sharedWithClient       Boolean       @default(false)
  itineraryTemplate      String?
  itineraryContent       Json?
  customNotes            String?
  inclusions             String[]
  exclusions             String[]
  importantInfo          String?
  termsAndConditions     String?
  pdfUrl                 String?
  shareableLink          String?       @unique
  linkPassword           String?
  linkExpiresAt          DateTime?
  // Payment Link System
  paymentLinkId          String?       @unique
  paymentLink            String?
  paymentStatus          PaymentLinkStatus @default(UNPAID)
  paidAt                 DateTime?
  paidAmount             Float?
  stripePaymentIntentId  String?       @unique
  stripeCheckoutSessionId String?      @unique
  emailSentCount         Int           @default(0)
  smsSentCount           Int           @default(0)
  convertedToBooking     Boolean       @default(false)
  bookingId              String?       @unique
  convertedAt            DateTime?
  sharedWithTeam         Boolean       @default(false)
  assignedTo             String?
  depositRequired        Boolean       @default(false)
  depositAmount          Float?
  depositDueDate         DateTime?
  finalPaymentDueDate    DateTime?
  timeToView             Int?
  timeToAccept           Int?
  timeToDecline          Int?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  deletedAt              DateTime?
  booking                AgentBooking?
  agent                  TravelAgent   @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client                 AgentClient   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  views                  QuoteView[]
  messages               QuoteMessage[]

  @@index([agentId, status])
  @@index([clientId, status])
  @@index([quoteNumber])
  @@index([status])
  @@index([expiresAt])
  @@index([createdAt])
  @@map("agent_quotes")
}

model AgentBooking {
  id                     String                @id @default(cuid())
  confirmationNumber     String                @unique
  bookingNumber          String?
  bookingReference       String?
  agentId                String
  clientId               String
  quoteId                String?               @unique
  tripName               String
  destination            String
  startDate              DateTime
  endDate                DateTime
  duration               Int
  travelers              Int
  adults                 Int
  children               Int
  infants                Int
  flights                Json[]
  hotels                 Json[]
  activities             Json[]
  transfers              Json[]
  carRentals             Json[]
  insurance              Json?
  customItems            Json[]
  subtotal               Float
  agentMarkup            Float
  taxes                  Float
  fees                   Float
  discount               Float
  total                  Float
  totalPrice             Float?
  commission             Float                 @default(0)
  currency               String                @default("USD")
  paymentStatus          PaymentStatus         @default(PENDING)
  depositAmount          Float                 @default(0)
  depositPaid            Boolean               @default(false)
  depositPaidAt          DateTime?
  depositDueDate         DateTime?
  balanceDue             Float
  balancePaid            Boolean               @default(false)
  balancePaidAt          DateTime?
  finalPaymentDue        DateTime?
  totalPaid              Float                 @default(0)
  paymentProvider        String?
  stripePaymentId        String?
  paypalTransactionId    String?
  paymentMethod          String?
  paymentMethodDetails   Json?
  flightConfirmations    Json?
  hotelConfirmations     Json?
  activityConfirmations  Json?
  transferConfirmations  Json?
  carRentalConfirmations Json?
  status                 BookingStatus         @default(PENDING)
  tripStarted            Boolean               @default(false)
  tripStartedAt          DateTime?
  tripCompleted          Boolean               @default(false)
  tripCompletedAt        DateTime?
  tripCancelled          Boolean               @default(false)
  tripCancelledAt        DateTime?
  cancellationReason     String?
  invoiceUrl             String?
  itineraryUrl           String?
  voucherUrls            Json?
  confirmationEmailSent  Boolean               @default(false)
  remindersSent          Int                   @default(0)
  supportTickets         Json?
  issuesReported         Int                   @default(0)
  issuesResolved         Int                   @default(0)
  clientSatisfaction     Float?
  reviewReceived         Boolean               @default(false)
  review                 String?
  reviewRating           Int?
  agentCommissionPaid    Boolean               @default(false)
  agentCommissionPaidAt  DateTime?
  holdPeriodEndsAt       DateTime?
  source                 String?
  deviceType             String?
  ipAddress              String?
  notes                  String?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  deletedAt              DateTime?
  agent                  TravelAgent           @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client                 AgentClient           @relation(fields: [clientId], references: [id], onDelete: Cascade)
  quote                  AgentQuote?           @relation(fields: [quoteId], references: [id])
  clientDocuments        AgentClientDocument[]
  commissions            AgentCommission[]

  @@index([agentId, status])
  @@index([clientId, status])
  @@index([confirmationNumber])
  @@index([status])
  @@index([paymentStatus])
  @@index([startDate])
  @@index([endDate])
  @@index([tripCompleted])
  @@map("agent_bookings")
}

model AgentCommission {
  id                 String           @id @default(cuid())
  agentId            String
  bookingId          String
  bookingTotal       Float
  supplierCost       Float
  grossProfit        Float
  platformFee        Float
  platformFeePercent Float
  agentEarnings      Float
  commissionRate     Float
  commissionAmount   Float
  bonusAmount        Float            @default(0)
  totalEarnings      Float
  flightCommission   Float            @default(0)
  hotelCommission    Float            @default(0)
  activityCommission Float            @default(0)
  transferCommission Float            @default(0)
  otherCommission    Float            @default(0)
  status             CommissionStatus @default(PENDING)
  bookingDate        DateTime
  tripStartDate      DateTime
  tripEndDate        DateTime
  holdUntil          DateTime?
  availableAt        DateTime?
  releasedAt         DateTime?
  paidAt             DateTime?
  payoutId           String?
  cancelled          Boolean          @default(false)
  cancelledAt        DateTime?
  refunded           Boolean          @default(false)
  refundedAt         DateTime?
  refundAmount       Float            @default(0)
  clawback           Boolean          @default(false)
  clawbackAmount     Float            @default(0)
  notes              String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  agent              TravelAgent      @relation(fields: [agentId], references: [id], onDelete: Cascade)
  booking            AgentBooking     @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  payout             AgentPayout?     @relation(fields: [payoutId], references: [id])

  @@index([agentId, status])
  @@index([bookingId])
  @@index([status])
  @@index([holdUntil])
  @@index([availableAt])
  @@map("agent_commissions")
}

model AgentPayout {
  id                  String            @id @default(cuid())
  payoutNumber        String?           @unique
  agentId             String
  amount              Float
  commissionCount     Int
  periodStart         DateTime
  periodEnd           DateTime
  method              String
  payoutEmail         String?
  stripeTransferId    String?
  paypalBatchId       String?
  bankTransferRef     String?
  checkNumber         String?
  status              PayoutStatus      @default(PENDING)
  requestedAt         DateTime          @default(now())
  processedAt         DateTime?
  completedAt         DateTime?
  failedAt            DateTime?
  failureReason       String?
  processingFee       Float             @default(0)
  netAmount           Float
  currency            String            @default("USD")
  invoiceNumber       String?           @unique
  receiptUrl          String?
  taxDocumentUrl      String?
  processedBy         String?
  approvedBy          String?
  approvedAt          DateTime?
  adminNotes          String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  commissionsIncluded AgentCommission[]
  agent               TravelAgent       @relation(fields: [agentId], references: [id], onDelete: Cascade)

  @@index([agentId, status])
  @@index([status])
  @@index([periodStart, periodEnd])
  @@index([requestedAt])
  @@map("agent_payouts")
}

model AgentTeamMember {
  id                String      @id @default(cuid())
  agencyId          String
  agentId           String
  role              TeamRole    @default(AGENT)
  permissions       Json?
  commissionSplit   Float       @default(0.70)
  overrideRate      Boolean     @default(false)
  customRate        Float?
  canManageClients  Boolean     @default(true)
  canCreateQuotes   Boolean     @default(true)
  canAcceptBookings Boolean     @default(true)
  canViewReports    Boolean     @default(false)
  canManageTeam     Boolean     @default(false)
  active            Boolean     @default(true)
  invitedAt         DateTime    @default(now())
  joinedAt          DateTime?
  suspendedAt       DateTime?
  removedAt         DateTime?
  removalReason     String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  agency            TravelAgent @relation("AgencyTeam", fields: [agencyId], references: [id], onDelete: Cascade)
  agent             TravelAgent @relation("AgentMemberships", fields: [agentId], references: [id], onDelete: Cascade)

  @@unique([agencyId, agentId])
  @@index([agencyId, active])
  @@index([agentId])
  @@map("agent_team_members")
}

model AgentClientNote {
  id                String      @id @default(cuid())
  clientId          String
  agentId           String
  quoteId           String?
  bookingId         String?
  note              String
  noteType          String      @default("general")
  isImportant       Boolean     @default(false)
  isPinned          Boolean     @default(false)
  contactMethod     String?
  duration          Int?
  outcome           String?
  requiresFollowUp  Boolean     @default(false)
  followUpDate      DateTime?
  followUpCompleted Boolean     @default(false)
  attachments       Json?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  client            AgentClient @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId, createdAt])
  @@index([agentId])
  @@index([requiresFollowUp, followUpDate])
  @@map("agent_client_notes")
}

model AgentClientDocument {
  id               String        @id @default(cuid())
  clientId         String
  bookingId        String?
  uploadedBy       String
  documentType     String
  fileName         String
  fileUrl          String
  fileSize         Int
  mimeType         String
  title            String?
  description      String?
  expiryDate       DateTime?
  sharedWithClient Boolean       @default(false)
  isConfidential   Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  deletedAt        DateTime?
  booking          AgentBooking? @relation(fields: [bookingId], references: [id])
  client           AgentClient   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([bookingId])
  @@index([documentType])
  @@map("agent_client_documents")
}

model AgentItineraryTemplate {
  id          String      @id @default(cuid())
  agentId     String
  name        String
  description String?
  category    String?
  design      String      @default("modern_minimalist")
  brandColor  String?
  logoUrl     String?
  headerImage String?
  sections    Json
  isDefault   Boolean     @default(false)
  isPublic    Boolean     @default(false)
  usageCount  Int         @default(0)
  lastUsed    DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  agent       TravelAgent @relation(fields: [agentId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@index([category])
  @@map("agent_itinerary_templates")
}

model AgentSupplier {
  id             String         @id @default(cuid())
  agentId        String
  name           String
  category       String         @default("other")
  contactName    String?
  contactEmail   String?
  contactPhone   String?
  website        String?
  address        String?
  city           String?
  country        String?
  apiEndpoint    String?
  apiKey         String?
  commissionRate Float          @default(0.10)
  paymentTerms   String?
  isPreferred    Boolean        @default(false)
  isActive       Boolean        @default(true)
  rating         Float?
  notes          String?
  metadata       Json?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  products       AgentProduct[]
  agent          TravelAgent    @relation("AgentSuppliers", fields: [agentId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@map("agent_suppliers")
}

model AgentProduct {
  id             String        @id @default(cuid())
  agentId        String
  supplierId     String
  name           String
  description    String?
  category       String        @default("other")
  type           String        @default("service")
  costPrice      Float         @default(0)
  sellPrice      Float         @default(0)
  currency       String        @default("USD")
  commissionRate Float         @default(0.10)
  isActive       Boolean       @default(true)
  isFeatured     Boolean       @default(false)
  stock          Int?
  minOrder       Int?          @default(1)
  maxOrder       Int?
  imageUrl       String?
  externalId     String?
  sku            String?
  tags           String[]
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  agent          TravelAgent   @relation("AgentProducts", fields: [agentId], references: [id], onDelete: Cascade)
  supplier       AgentSupplier @relation(fields: [supplierId], references: [id])

  @@index([agentId])
  @@index([supplierId])
  @@index([isActive])
  @@map("agent_products")
}

model AgentActivityLog {
  id           String      @id @default(cuid())
  agentId      String
  activityType String
  description  String
  entityType   String?
  entityId     String?
  metadata     Json?
  ipAddress    String?
  userAgent    String?
  location     String?
  createdAt    DateTime    @default(now())
  agent        TravelAgent @relation(fields: [agentId], references: [id], onDelete: Cascade)

  @@index([agentId, createdAt])
  @@index([activityType])
  @@index([entityType, entityId])
  @@map("agent_activity_logs")
}

// ============================================
// QUOTE SYSTEM EXTENSIONS
// ============================================

model QuoteTemplate {
  id              String      @id @default(cuid())
  agentId         String
  name            String
  description     String?
  category        String?     // honeymoon, business, family, luxury, budget
  isDefault       Boolean     @default(false)
  isPublic        Boolean     @default(false)
  usageCount      Int         @default(0)
  // Template Data
  tripName        String?
  destination     String?
  duration        Int?
  travelers       Int?
  adults          Int?
  children        Int?
  infants         Int?
  flights         Json[]
  hotels          Json[]
  activities      Json[]
  transfers       Json[]
  carRentals      Json[]
  insurance       Json?
  customItems     Json[]
  // Pricing defaults
  agentMarkupPercent Float?
  taxes           Float?
  fees            Float?
  // Content
  inclusions      String[]
  exclusions      String[]
  importantInfo   String?
  termsAndConditions String?
  customNotes     String?
  // Metadata
  lastUsedAt      DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  agent           TravelAgent @relation("AgentQuoteTemplates", fields: [agentId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@index([category])
  @@index([isPublic])
  @@map("quote_templates")
}

model QuoteView {
  id            String    @id @default(cuid())
  quoteId       String
  sessionId     String?
  ipAddress     String?
  userAgent     String?
  device        String?   // mobile, tablet, desktop
  browser       String?
  os            String?
  country       String?
  city          String?
  referrer      String?
  duration      Int?      // seconds spent viewing
  scrollDepth   Int?      // 0-100 percentage
  sectionsViewed String[] // intro, itinerary, pricing, etc.
  clickedCTA    Boolean   @default(false)
  ctaType       String?   // accept, decline, download, share
  createdAt     DateTime  @default(now())
  quote         AgentQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([createdAt])
  @@map("quote_views")
}

model QuoteAnalytics {
  id                  String   @id @default(cuid())
  agentId             String
  period              String   // daily, weekly, monthly
  periodStart         DateTime
  periodEnd           DateTime
  // Quote Metrics
  totalQuotes         Int      @default(0)
  draftQuotes         Int      @default(0)
  sentQuotes          Int      @default(0)
  viewedQuotes        Int      @default(0)
  acceptedQuotes      Int      @default(0)
  declinedQuotes      Int      @default(0)
  expiredQuotes       Int      @default(0)
  convertedQuotes     Int      @default(0)
  // Financial
  totalQuoteValue     Float    @default(0)
  avgQuoteValue       Float    @default(0)
  totalAcceptedValue  Float    @default(0)
  totalDeclinedValue  Float    @default(0)
  // Performance
  avgTimeToView       Float?   // minutes
  avgTimeToAccept     Float?   // minutes
  avgTimeToDecline    Float?   // minutes
  conversionRate      Float    @default(0)
  viewRate            Float    @default(0)
  // Engagement
  totalViews          Int      @default(0)
  uniqueViews         Int      @default(0)
  avgViewDuration     Float?
  avgScrollDepth      Float?
  mobileViews         Int      @default(0)
  desktopViews        Int      @default(0)
  // Delivery
  emailsSent          Int      @default(0)
  smsSent             Int      @default(0)
  whatsappSent        Int      @default(0)
  // Top performers
  topDestinations     Json?
  topProducts         Json?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  agent               TravelAgent @relation("AgentQuoteAnalytics", fields: [agentId], references: [id], onDelete: Cascade)

  @@unique([agentId, period, periodStart])
  @@index([agentId, period])
  @@index([periodStart, periodEnd])
  @@map("quote_analytics")
}

model QuoteComparison {
  id          String   @id @default(cuid())
  agentId     String
  clientId    String
  name        String
  description String?
  quoteIds    String[] // Array of quote IDs to compare
  isActive    Boolean  @default(true)
  shareableLink String? @unique
  viewCount   Int      @default(0)
  lastViewedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  expiresAt   DateTime?
  agent       TravelAgent @relation("AgentQuoteComparisons", fields: [agentId], references: [id], onDelete: Cascade)
  client      AgentClient @relation("ClientQuoteComparisons", fields: [clientId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@index([clientId])
  @@map("quote_comparisons")
}

model QuoteMessage {
  id          String    @id @default(cuid())
  quoteId     String
  channel     String    // email, sms, whatsapp
  recipient   String
  subject     String?
  content     String
  status      String    @default("pending") // pending, sent, delivered, failed
  sentAt      DateTime?
  deliveredAt DateTime?
  failedAt    DateTime?
  failReason  String?
  externalId  String?   // Twilio SID, etc.
  metadata    Json?
  createdAt   DateTime  @default(now())
  quote       AgentQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([channel, status])
  @@map("quote_messages")
}

model WorldCupTeam {
  id              String            @id @default(cuid())
  name            String            @unique
  shortName       String
  fifaCode        String            @unique
  flagEmoji       String
  primaryColor    String
  secondaryColor  String
  accentColor     String?
  flagUrl         String
  logoUrl         String?
  fifaRanking     Int?
  confederation   String
  group           String?
  headCoach       String?
  captain         String?
  starPlayers     Json?
  worldCupWins    Int               @default(0)
  worldCupApps    Int               @default(0)
  bestFinish      String?
  description     String?
  slug            String            @unique
  metaTitle       String?
  metaDescription String?
  content         String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  bookings        WorldCupBooking[]
  awayMatches     WorldCupMatch[]   @relation("AwayTeam")
  homeMatches     WorldCupMatch[]   @relation("HomeTeam")

  @@index([slug])
  @@index([group])
  @@index([confederation])
  @@map("world_cup_teams")
}

model WorldCupStadium {
  id                 String          @id @default(cuid())
  name               String          @unique
  nickname           String?
  city               String
  state              String?
  country            String
  address            String?
  latitude           Float?
  longitude          Float?
  timezone           String
  capacity           Int
  opened             Int?
  surface            String?
  roofType           String?
  imageUrl           String?
  images             Json?
  seatingChart       String?
  virtualTour        String?
  nearestAirport     String?
  airportDistance    Float?
  publicTransit      String?
  parkingInfo        String?
  nearbyHotels       Json?
  restaurants        Json?
  attractions        Json?
  cityPrimaryColor   String?
  citySecondaryColor String?
  slug               String          @unique
  metaTitle          String?
  metaDescription    String?
  description        String?
  travelGuide        String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  matches            WorldCupMatch[]

  @@index([slug])
  @@index([city])
  @@index([country])
  @@map("world_cup_stadiums")
}

model WorldCupMatch {
  id               String            @id @default(cuid())
  matchNumber      Int               @unique
  fifaMatchId      String?           @unique
  homeTeamId       String?
  awayTeamId       String?
  stadiumId        String
  matchDate        DateTime
  matchTime        String
  localTime        String
  stage            MatchStage
  groupName        String?
  roundName        String
  status           MatchStatus       @default(SCHEDULED)
  homeScore        Int?
  awayScore        Int?
  penalties        Json?
  ticketsAvailable Boolean           @default(true)
  ticketPriceMin   Float?
  ticketPriceMax   Float?
  ticketProviders  Json?
  matchPosterUrl   String?
  broadcastInfo    Json?
  slug             String            @unique
  metaTitle        String?
  metaDescription  String?
  preview          String?
  recap            String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  bookings         WorldCupBooking[]
  awayTeam         WorldCupTeam?     @relation("AwayTeam", fields: [awayTeamId], references: [id])
  homeTeam         WorldCupTeam?     @relation("HomeTeam", fields: [homeTeamId], references: [id])
  stadium          WorldCupStadium   @relation(fields: [stadiumId], references: [id])
  tickets          WorldCupTicket[]

  @@index([matchDate])
  @@index([stadiumId])
  @@index([stage])
  @@index([slug])
  @@map("world_cup_matches")
}

model WorldCupTicket {
  id               String           @id @default(cuid())
  provider         String
  providerTicketId String
  matchId          String
  section          String
  row              String?
  seatNumber       String?
  quantity         Int              @default(1)
  seatType         String?
  faceValue        Float?
  wholesalePrice   Float
  retailPrice      Float
  markup           Float
  currency         String           @default("USD")
  available        Boolean          @default(true)
  reserved         Boolean          @default(false)
  reservedUntil    DateTime?
  sold             Boolean          @default(false)
  features         Json?
  seatView         String?
  bookingId        String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  booking          WorldCupBooking? @relation(fields: [bookingId], references: [id])
  match            WorldCupMatch    @relation(fields: [matchId], references: [id])

  @@index([matchId, available])
  @@index([provider])
  @@index([retailPrice])
  @@map("world_cup_tickets")
}

model WorldCupBooking {
  id                 String           @id @default(cuid())
  userId             String
  packageType        String
  packageName        String
  matchId            String?
  teamId             String?
  flightBooking      Json?
  hotelBooking       Json?
  carRental          Json?
  experiences        Json?
  ticketsTotal       Float            @default(0)
  flightsTotal       Float            @default(0)
  hotelsTotal        Float            @default(0)
  carsTotal          Float            @default(0)
  experiencesTotal   Float            @default(0)
  subtotal           Float
  taxes              Float            @default(0)
  fees               Float            @default(0)
  total              Float
  currency           String           @default("USD")
  paymentStatus      String           @default("PENDING")
  paymentMethod      String?
  stripePaymentId    String?
  paidAt             DateTime?
  status             String           @default("CONFIRMED")
  confirmationNumber String           @unique
  ticketsDelivered   Boolean          @default(false)
  deliveryMethod     String?
  deliveredAt        DateTime?
  customerName       String
  customerEmail      String
  customerPhone      String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  cancelledAt        DateTime?
  match              WorldCupMatch?   @relation(fields: [matchId], references: [id])
  team               WorldCupTeam?    @relation(fields: [teamId], references: [id])
  user               User             @relation(fields: [userId], references: [id])
  tickets            WorldCupTicket[]

  @@index([userId])
  @@index([matchId])
  @@index([teamId])
  @@index([status])
  @@index([confirmationNumber])
  @@map("world_cup_bookings")
}

model CardAuthorization {
  id                String         @id @default(cuid())
  bookingReference  String         @unique
  cardholderName    String
  cardLast4         String
  cardBrand         String
  expiryMonth       Int
  expiryYear        Int
  billingStreet     String
  billingCity       String
  billingState      String
  billingZip        String
  billingCountry    String
  email             String
  phone             String
  amount            Float
  currency          String         @default("USD")
  cardFrontImage    String?
  cardBackImage     String?
  idDocumentImage   String?
  signatureImage    String?
  signatureTyped    String
  ackAuthorize      Boolean        @default(false)
  ackCardholder     Boolean        @default(false)
  ackNonRefundable  Boolean        @default(false)
  ackPassengerInfo  Boolean        @default(false)
  ackTerms          Boolean        @default(false)
  ipAddress         String
  userAgent         String?
  deviceFingerprint String?
  status            CardAuthStatus @default(PENDING)
  verifiedAt        DateTime?
  verifiedBy        String?
  rejectionReason   String?
  riskScore         Int?
  riskFactors       Json?
  submittedAt       DateTime       @default(now())
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  @@index([bookingReference])
  @@index([status])
  @@index([email])
  @@index([submittedAt])
  @@map("card_authorizations")
}

model AirlineContract {
  id               String                   @id @default(cuid())
  airlineCode      String
  airlineName      String
  allianceCode     String?
  ticketStock      String?
  validFrom        DateTime
  validTo          DateTime
  isActive         Boolean                  @default(true)
  tourCode         String?
  ticketDesignator String?
  gdsAllowed       Boolean                  @default(true)
  ndcAllowed       Boolean                  @default(true)
  ndcDirectAllowed Boolean                  @default(false)
  notes            String?
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime                 @updatedAt
  routes           AirlineCommissionRoute[]

  @@unique([airlineCode, validFrom])
  @@index([airlineCode])
  @@index([isActive])
  @@index([validFrom, validTo])
  @@map("airline_contracts")
}

model AirlineCommissionRoute {
  id                           String                       @id @default(cuid())
  contractId                   String
  originType                   AirlineRouteType             @default(ANY)
  originCodes                  String[]
  originExclusions             String[]
  destinationType              AirlineRouteType             @default(ANY)
  destinationCodes             String[]
  destinationExclusions        String[]
  bidirectional                Boolean                      @default(true)
  operatingCarrierRequired     Boolean                      @default(false)
  marketingCarrierRequired     Boolean                      @default(false)
  interlineAllowed             Boolean                      @default(true)
  interlineCommissionReduction Float?
  validFrom                    DateTime?
  validTo                      DateTime?
  tourCodeOverride             String?
  priority                     Int                          @default(0)
  createdAt                    DateTime                     @default(now())
  updatedAt                    DateTime                     @updatedAt
  fareClasses                  AirlineCommissionFareClass[]
  contract                     AirlineContract              @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@index([contractId])
  @@index([originCodes])
  @@index([destinationCodes])
  @@map("airline_commission_routes")
}

model AirlineCommissionFareClass {
  id                  String                 @id @default(cuid())
  routeId             String
  bookingCodes        String[]
  cabinClass          CabinClass
  fareFamily          String?
  defaultPct          Float
  lowSeasonPct        Float?
  shoulderSeasonPct   Float?
  highSeasonPct       Float?
  peakSeasonPct       Float?
  lowSeasonDates      Json?
  shoulderSeasonDates Json?
  highSeasonDates     Json?
  peakSeasonDates     Json?
  blackoutDates       Json?
  infantCommission    Boolean                @default(false)
  childCommission     Boolean                @default(true)
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  route               AirlineCommissionRoute @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId])
  @@index([cabinClass])
  @@map("airline_commission_fare_classes")
}

model AirlineCommissionExclusion {
  id                   String               @id @default(cuid())
  airlineCode          String?
  exclusionType        AirlineExclusionType
  description          String
  fareBasisRule        String?
  fareBasisPattern     String?
  excludedBookingCodes String[]
  excludedFareFamilies String[]
  isActive             Boolean              @default(true)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt

  @@index([airlineCode])
  @@index([exclusionType])
  @@index([isActive])
  @@map("airline_commission_exclusions")
}

model GeographicMarket {
  id               String   @id @default(cuid())
  marketCode       String   @unique
  marketName       String
  countryCodes     String[]
  regions          String[]
  includedAirports String[]
  excludedAirports String[]
  description      String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("geographic_markets")
}

model LCCAirline {
  id          String   @id @default(cuid())
  airlineCode String   @unique
  airlineName String
  notes       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("lcc_airlines")
}

model RoutingDecision {
  id                 String         @id @default(cuid())
  searchId           String?
  offerId            String
  airlineCode        String
  origin             String
  destination        String
  departureDate      DateTime
  cabinClass         CabinClass
  fareClass          String?
  fareBasisCode      String?
  baseFare           Float
  totalFare          Float
  currency           String         @default("USD")
  commissionPct      Float?
  commissionAmount   Float?
  isExcluded         Boolean        @default(false)
  exclusionReason    String?
  routingChannel     RoutingChannel
  estimatedProfit    Float
  decisionReason     String
  duffelProfit       Float?
  consolidatorProfit Float?
  bookingId          String?
  wasBooked          Boolean        @default(false)
  createdAt          DateTime       @default(now())

  @@index([airlineCode])
  @@index([routingChannel])
  @@index([createdAt])
  @@index([searchId])
  @@map("routing_decisions")
}

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([key])
  @@map("system_configs")
}

model PromoCodeUsage {
  id              String    @id @default(cuid())
  promoCodeId     String
  userId          String?
  bookingId       String?
  bookingType     String
  discountApplied Float
  orderTotal      Float
  currency        String    @default("USD")
  usedAt          DateTime  @default(now())
  promoCode       PromoCode @relation(fields: [promoCodeId], references: [id], onDelete: Cascade)
  user            User?     @relation(fields: [userId], references: [id])

  @@index([promoCodeId])
  @@index([userId])
  @@index([usedAt])
  @@map("promo_code_usages")
}

model NewsletterSubscriber {
  id                String    @id @default(cuid())
  email             String    @unique
  firstName         String?
  source            String    @default("website")
  status            String    @default("PENDING")
  subscribedAt      DateTime  @default(now())
  unsubscribedAt    DateTime?
  reactivatedAt     DateTime?
  verifiedAt        DateTime?
  verificationToken String?
  tokenExpiry       DateTime?
  lastEmailSentAt   DateTime?
  emailsSent        Int       @default(0)
  emailsOpened      Int       @default(0)
  emailsClicked     Int       @default(0)
  dealAlerts        Boolean   @default(true)
  newRoutes         Boolean   @default(true)
  weeklyDigest      Boolean   @default(true)
  worldCupUpdates   Boolean   @default(true)
  ipAddress         String?
  userAgent         String?
  country           String?

  @@index([status])
  @@index([subscribedAt])
  @@index([source])
  @@index([verificationToken])
  @@map("newsletter_subscribers")
}

model AirlineProfile {
  id                   String                    @id @default(cuid())
  iataCode             String                    @unique
  icaoCode             String?
  callsign             String?
  name                 String
  shortName            String?
  legalName            String?
  alliance             String?
  logoUrl              String?
  logoUrlSvg           String?
  brandPrimaryColor    String?
  brandSecondaryColor  String?
  country              String?
  countryName          String?
  headquarters         String?
  foundedYear          Int?
  websiteUrl           String?
  customerServicePhone String?
  hubAirports          String[]
  loyaltyProgramName   String?
  loyaltyTiers         Json?
  fleetSize            Int?
  averageFleetAge      Float?
  aircraftTypes        String[]
  cabinClasses         String[]
  hasPremiumEconomy    Boolean                   @default(false)
  hasLieFlat           Boolean                   @default(false)
  hasWifi              Boolean                   @default(false)
  wifiType             String?
  hasIFE               Boolean                   @default(false)
  hasPowerOutlets      Boolean                   @default(false)
  mealService          String?
  alcoholPolicy        String?
  carryOnIncluded      Boolean                   @default(true)
  checkedBagIncluded   Boolean                   @default(false)
  firstBagFeeUSD       Float?
  secondBagFeeUSD      Float?
  overallRating        Float?
  onTimeRating         Float?
  comfortRating        Float?
  serviceRating        Float?
  valueRating          Float?
  onTimePercentage     Float?
  cancellationRate     Float?
  avgDelayMinutes      Float?
  duffelId             String?
  amadeusId            String?
  airlineType          AirlineType               @default(FSC)
  isActive             Boolean                   @default(true)
  descriptionEmbedding Float[]
  tags                 String[]
  lastSyncedAt         DateTime?
  dataSource           String?
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  fleet                AirlineFleet[]
  knowledgeEntries     AirlineKnowledgeEntry[]
  operationalStats     AirlineOperationalStats[]
  routes               AirlineRouteProfile[]

  @@index([iataCode])
  @@index([alliance])
  @@index([country])
  @@index([airlineType])
  @@map("airline_profiles")
}

model AirlineFleet {
  id           String         @id @default(cuid())
  airlineId    String
  aircraftType String
  icaoType     String?
  manufacturer String?
  model        String?
  count        Int
  averageAge   Float?
  seatConfig   Json?
  totalSeats   Int?
  rangeKm      Int?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  airline      AirlineProfile @relation(fields: [airlineId], references: [id], onDelete: Cascade)

  @@unique([airlineId, aircraftType])
  @@index([airlineId])
  @@map("airline_fleet")
}

model AirlineRouteProfile {
  id                String         @id @default(cuid())
  airlineId         String
  originIata        String
  destinationIata   String
  routeType         String?
  dailyFlights      Int?
  weeklyFlights     Int?
  seasonality       String?
  avgEconomyFare    Float?
  avgBusinessFare   Float?
  priceVolatility   Float?
  onTimePercentage  Float?
  avgFlightDuration Int?
  aircraftTypes     String[]
  competitorCount   Int?
  marketShare       Float?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  airline           AirlineProfile @relation(fields: [airlineId], references: [id], onDelete: Cascade)

  @@unique([airlineId, originIata, destinationIata])
  @@index([airlineId])
  @@index([originIata])
  @@index([destinationIata])
  @@map("airline_routes")
}

model AirlineOperationalStats {
  id               String         @id @default(cuid())
  airlineId        String
  periodType       String
  periodStart      DateTime
  periodEnd        DateTime
  totalFlights     Int?
  onTimeFlights    Int?
  delayedFlights   Int?
  cancelledFlights Int?
  avgDelayMinutes  Float?
  loadFactor       Float?
  complaints       Int?
  createdAt        DateTime       @default(now())
  airline          AirlineProfile @relation(fields: [airlineId], references: [id], onDelete: Cascade)

  @@unique([airlineId, periodType, periodStart])
  @@index([airlineId])
  @@index([periodStart])
  @@map("airline_operational_stats")
}

model AirlineKnowledgeEntry {
  id         String          @id @default(cuid())
  airlineId  String?
  title      String
  content    String
  category   String
  source     String?
  sourceUrl  String?
  embedding  Float[]
  language   String          @default("en")
  isVerified Boolean         @default(false)
  confidence Float?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  airline    AirlineProfile? @relation(fields: [airlineId], references: [id], onDelete: Cascade)

  @@index([airlineId])
  @@index([category])
  @@map("airline_knowledge_entries")
}

model AirlineDataSyncLog {
  id              String   @id @default(cuid())
  source          String
  status          String
  airlinesUpdated Int      @default(0)
  airlinesCreated Int      @default(0)
  errorMessage    String?
  duration        Int?
  createdAt       DateTime @default(now())

  @@index([source])
  @@index([createdAt])
  @@map("airline_data_sync_logs")
}

model Aircraft {
  id              String            @id @default(cuid())
  iataCode        String            @unique
  icaoCode        String?           @unique
  manufacturer    String
  model           String
  fullName        String
  family          String?
  variant         String?
  category        AircraftCategory  @default(NARROWBODY)
  engineType      String?
  engineCount     Int?
  rangeKm         Int?
  rangeMiles      Int?
  cruiseSpeedKmh  Int?
  cruiseSpeedMph  Int?
  maxAltitudeFt   Int?
  fuelCapacityL   Int?
  maxPassengers   Int?
  typicalSeats    Int?
  cargoCapacityM3 Float?
  lengthM         Float?
  wingspanM       Float?
  heightM         Float?
  cabinWidthM     Float?
  hasWideBody     Boolean           @default(false)
  aisleCount      Int               @default(1)
  seatWidthInches Float?
  windowsPerRow   Int?
  firstFlight     DateTime?
  inProduction    Boolean           @default(true)
  unitsBuilt      Int?
  operators       String[]
  imageUrl        String?
  schematicUrl    String?
  dataSource      String?
  lastUpdated     DateTime          @default(now())
  createdAt       DateTime          @default(now())
  seatMaps        AircraftSeatMap[]
  flightRecords   FlightRecord[]

  @@index([manufacturer])
  @@index([category])
  @@map("aircraft")
}

model AircraftSeatMap {
  id              String   @id @default(cuid())
  aircraftId      String
  airlineCode     String?
  configName      String?
  firstClassRows  Int      @default(0)
  firstClassSeats Int      @default(0)
  firstClassPitch Int?
  firstClassWidth Float?
  businessRows    Int      @default(0)
  businessSeats   Int      @default(0)
  businessPitch   Int?
  businessWidth   Float?
  businessLieFlat Boolean  @default(false)
  premiumEcoRows  Int      @default(0)
  premiumEcoSeats Int      @default(0)
  premiumEcoPitch Int?
  premiumEcoWidth Float?
  economyRows     Int      @default(0)
  economySeats    Int      @default(0)
  economyPitch    Int?
  economyWidth    Float?
  totalSeats      Int
  seatLayout      String?
  exitRows        Int[]
  extraLegroom    Int[]
  hasIFE          Boolean  @default(false)
  hasPower        Boolean  @default(false)
  hasWifi         Boolean  @default(false)
  seatMapJson     Json?
  seatMapUrl      String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  aircraft        Aircraft @relation(fields: [aircraftId], references: [id], onDelete: Cascade)

  @@unique([aircraftId, airlineCode, configName])
  @@index([aircraftId])
  @@index([airlineCode])
  @@map("aircraft_seat_maps")
}

model Airport {
  id               String         @id @default(cuid())
  iataCode         String         @unique
  icaoCode         String?        @unique
  name             String
  shortName        String?
  city             String
  cityCode         String?
  state            String?
  country          String
  countryName      String?
  continent        String?
  region           String?
  latitude         Float?
  longitude        Float?
  elevation        Int?
  timezone         String?
  utcOffset        Float?
  airportType      AirportType    @default(LARGE)
  isHub            Boolean        @default(false)
  isInternational  Boolean        @default(true)
  hubFor           String[]
  terminalCount    Int?
  terminals        Json?
  runways          Int?
  longestRunway    Int?
  annualPassengers Int?
  annualFlights    Int?
  hasLounge        Boolean        @default(false)
  loungeCount      Int?
  hasHotel         Boolean        @default(false)
  hasFreeWifi      Boolean        @default(false)
  hasMetro         Boolean        @default(false)
  hasTrainStation  Boolean        @default(false)
  distanceToCity   Float?
  avgTransferTime  Int?
  websiteUrl       String?
  phoneNumber      String?
  imageUrl         String?
  mapUrl           String?
  duffelId         String?
  amadeusId        String?
  dataSource       String?
  lastUpdated      DateTime       @default(now())
  createdAt        DateTime       @default(now())
  arrivalFlights   FlightRecord[] @relation("ArrivalAirport")
  departureFlights FlightRecord[] @relation("DepartureAirport")

  @@index([city])
  @@index([country])
  @@index([airportType])
  @@map("airports")
}

model FareClass {
  id                String     @id @default(cuid())
  code              String
  airlineCode       String?
  name              String
  brandName         String?
  cabinClass        CabinClass
  tier              Int?
  bookingClasses    String[]
  isAward           Boolean    @default(false)
  isUpgrade         Boolean    @default(false)
  seatSelection     String?
  seatPitch         Int?
  seatWidth         Float?
  seatRecline       Int?
  legroom           String?
  carryOnIncluded   Boolean    @default(true)
  carryOnSize       String?
  checkedBags       Int        @default(0)
  firstBagWeight    Int?
  secondBagWeight   Int?
  excessBagFee      Float?
  changeAllowed     Boolean    @default(false)
  changeFee         Float?
  changeAnytime     Boolean    @default(false)
  cancelAllowed     Boolean    @default(false)
  cancelFee         Float?
  refundable        Boolean    @default(false)
  refundType        String?
  noShowProtection  Boolean    @default(false)
  milesEarning      Int?
  eliteCredits      Int?
  upgradeEligible   Boolean    @default(false)
  loungAccess       Boolean    @default(false)
  priorityBoarding  Boolean    @default(false)
  prioritySecurity  Boolean    @default(false)
  priorityBaggage   Boolean    @default(false)
  mealIncluded      Boolean    @default(false)
  mealType          String?
  alcoholIncluded   Boolean    @default(false)
  entertainmentFree Boolean    @default(true)
  wifiFree          Boolean    @default(false)
  dataSource        String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@unique([code, airlineCode])
  @@index([airlineCode])
  @@index([cabinClass])
  @@map("fare_classes")
}

model FlightRecord {
  id               String    @id @default(cuid())
  flightNumber     String
  airlineCode      String
  operatingCarrier String?
  operatingFlight  String?
  originId         String
  destinationId    String
  originIata       String
  destinationIata  String
  aircraftId       String?
  aircraftIata     String?
  aircraftName     String?
  departureDate    DateTime
  departureTime    String?
  arrivalTime      String?
  departureLocal   DateTime?
  arrivalLocal     DateTime?
  durationMinutes  Int?
  status           String?
  actualDeparture  DateTime?
  actualArrival    DateTime?
  delayMinutes     Int?
  economyPrice     Float?
  businessPrice    Float?
  firstPrice       Float?
  currency         String    @default("USD")
  fareClass        String?
  fareBrand        String?
  seatsTotal       Int?
  seatsAvailable   Int?
  loadFactor       Float?
  offerId          String?
  source           String    @default("duffel")
  observedAt       DateTime  @default(now())
  aircraft         Aircraft? @relation(fields: [aircraftId], references: [id])
  destination      Airport   @relation("ArrivalAirport", fields: [destinationId], references: [id])
  origin           Airport   @relation("DepartureAirport", fields: [originId], references: [id])

  @@index([airlineCode])
  @@index([flightNumber])
  @@index([originIata])
  @@index([destinationIata])
  @@index([departureDate])
  @@index([observedAt])
  @@map("flight_records")
}

model RouteStatistics {
  id                String   @id @default(cuid())
  originIata        String
  destinationIata   String
  routeKey          String   @unique
  distanceKm        Int?
  distanceMiles     Int?
  flightTimeMin     Int?
  operatingAirlines String[]
  carrierCount      Int?
  dominantCarrier   String?
  marketShare       Json?
  dailyFlights      Int?
  weeklyFlights     Int?
  seasonality       String?
  peakMonths        Int[]
  avgEconomyPrice   Float?
  avgBusinessPrice  Float?
  avgFirstPrice     Float?
  priceVolatility   Float?
  cheapestMonth     Int?
  expensiveMonth    Int?
  advancePurchase   Int?
  avgDelay          Float?
  onTimeRate        Float?
  cancellationRate  Float?
  isCompetitive     Boolean  @default(false)
  hasBudgetOption   Boolean  @default(false)
  lastAnalyzed      DateTime @default(now())
  dataPoints        Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([originIata])
  @@index([destinationIata])
  @@map("route_statistics")
}

model PriceTrend {
  id              String   @id @default(cuid())
  originIata      String
  destinationIata String
  airlineCode     String?
  searchDate      DateTime
  departureDate   DateTime
  daysInAdvance   Int
  economyMin      Float?
  economyAvg      Float?
  economyMax      Float?
  businessMin     Float?
  businessAvg     Float?
  businessMax     Float?
  currency        String   @default("USD")
  offersCount     Int      @default(1)
  source          String   @default("duffel")
  createdAt       DateTime @default(now())

  @@index([originIata, destinationIata])
  @@index([searchDate])
  @@index([departureDate])
  @@index([daysInAdvance])
  @@map("price_trends")
}

model AviationDataSyncLog {
  id               String   @id @default(cuid())
  entityType       String
  source           String
  operation        String
  status           String
  recordsProcessed Int      @default(0)
  recordsCreated   Int      @default(0)
  recordsUpdated   Int      @default(0)
  recordsFailed    Int      @default(0)
  errorDetails     Json?
  durationMs       Int?
  metadata         Json?
  createdAt        DateTime @default(now())

  @@index([entityType])
  @@index([source])
  @@index([createdAt])
  @@map("aviation_data_sync_logs")
}

model EmailLog {
  id             String    @id @default(cuid())
  recipientEmail String
  userId         String?
  emailType      String
  template       String
  event          String?
  subject        String?
  status         String    @default("sent")
  sentAt         DateTime  @default(now())
  deliveredAt    DateTime?
  openedAt       DateTime?
  clickedAt      DateTime?
  opens          Int       @default(0)
  clicks         Int       @default(0)
  bounceType     String?
  bounceReason   String?
  failureReason  String?
  aiDecision     String?
  clientInfo     String?
  geolocation    String?
  metadata       String?
  createdAt      DateTime  @default(now())

  @@index([recipientEmail])
  @@index([userId])
  @@index([sentAt])
  @@index([emailType])
  @@map("email_logs")
}

model EmailDecisionLog {
  id         String   @id @default(cuid())
  email      String
  event      String
  decision   String
  reason     String
  confidence Float?
  metadata   String?
  createdAt  DateTime @default(now())

  @@index([email])
  @@index([createdAt])
  @@map("email_decision_logs")
}

model ScheduledEmail {
  id           String    @id @default(cuid())
  email        String
  event        String
  payload      String
  scheduledFor DateTime
  status       String    @default("pending")
  sentAt       DateTime?
  createdAt    DateTime  @default(now())

  @@index([scheduledFor])
  @@index([status])
  @@map("scheduled_emails")
}

model CampaignLog {
  id         String   @id @default(cuid())
  campaignId String
  userId     String
  email      String
  event      String
  step       Int?
  metadata   String?
  createdAt  DateTime @default(now())

  @@index([campaignId])
  @@index([userId])
  @@map("campaign_logs")
}

model EmailSuppression {
  id        String   @id @default(cuid())
  email     String   @unique
  reason    String
  details   String?
  createdAt DateTime @default(now())

  @@map("email_suppressions")
}

model ContentQueue {
  id          String          @id @default(cuid())
  type        String
  title       String
  content     String
  platforms   String[]
  imageUrl    String?
  imagePrompt String?
  link        String?
  hashtags    String[]
  productType String?
  productId   String?
  productData Json?
  scheduledAt DateTime
  timezone    String          @default("America/New_York")
  status      String          @default("pending")
  priority    Int             @default(0)
  retryCount  Int             @default(0)
  maxRetries  Int             @default(3)
  error       String?
  postedAt    DateTime?
  results     Json?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  createdBy   String?
  posts       SocialPostLog[]

  @@index([status, scheduledAt])
  @@index([platforms])
  @@index([productType, productId])
  @@map("content_queue")
}

model SocialPostLog {
  id             String        @id @default(cuid())
  contentQueueId String?
  platform       String
  platformPostId String?
  platformUrl    String?
  status         String        @default("pending")
  content        String
  imageUrl       String?
  link           String?
  impressions    Int           @default(0)
  engagements    Int           @default(0)
  clicks         Int           @default(0)
  shares         Int           @default(0)
  conversions    Int           @default(0)
  revenue        Decimal       @default(0) @db.Decimal(10, 2)
  error          String?
  metadata       Json?
  postedAt       DateTime?
  lastSyncAt     DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  contentQueue   ContentQueue? @relation(fields: [contentQueueId], references: [id])

  @@unique([platform, platformPostId])
  @@index([contentQueueId])
  @@index([platform, status])
  @@index([postedAt])
  @@map("social_post_logs")
}

enum AgentTier {
  INDEPENDENT
  PROFESSIONAL
  AGENCY_PARTNER
  WHITE_LABEL
}

enum AgentStatus {
  PENDING
  ACTIVE
  SUSPENDED
  INACTIVE
  BANNED
}

enum CommissionModel {
  PERCENTAGE
  FLAT_FEE
  HYBRID
  CUSTOM
}

enum ClientSegment {
  STANDARD
  VIP
  HONEYMOON
  FAMILY
  BUSINESS
  GROUP_ORGANIZER
  CORPORATE
  LUXURY
}

enum ClientStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
  LOST
  DO_NOT_CONTACT
}

enum QuoteStatus {
  DRAFT
  SENT
  VIEWED
  MODIFIED
  ACCEPTED
  EXPIRED
  DECLINED
  CONVERTED
}

enum PaymentLinkStatus {
  UNPAID
  PENDING
  PAID
  FAILED
  REFUNDED
  EXPIRED
  CANCELLED
  ARCHIVED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  PARTIALLY_PAID
  FULLY_PAID
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REFUNDED
  NO_SHOW
}

enum PaymentStatus {
  PENDING
  DEPOSIT_PAID
  FULLY_PAID
  PARTIALLY_REFUNDED
  REFUNDED
  FAILED
  DISPUTED
}

enum CommissionStatus {
  PENDING
  TRIP_IN_PROGRESS
  IN_HOLD_PERIOD
  AVAILABLE
  PAID
  CANCELLED
  REFUNDED
}

enum PayoutStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum TeamRole {
  OWNER
  MANAGER
  AGENT
  VIEWER
}

enum MatchStage {
  GROUP_STAGE
  ROUND_16
  QUARTER_FINAL
  SEMI_FINAL
  THIRD_PLACE
  FINAL
}

enum MatchStatus {
  SCHEDULED
  LIVE
  HALFTIME
  FINISHED
  POSTPONED
  CANCELLED
}

enum CardAuthStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

enum AirlineRouteType {
  ANY
  AIRPORT
  CITY
  COUNTRY
  REGION
  MARKET
}

enum CabinClass {
  FIRST
  BUSINESS
  PREMIUM_ECONOMY
  ECONOMY
  BASIC_ECONOMY
}

enum AirlineExclusionType {
  BASIC_ECONOMY
  LIGHT_FARE
  GROUP_FARE
  NET_FARE
  CORPORATE_FARE
  MILITARY_FARE
  INFANT_FARE
  WEB_FARE
  PROMO_FARE
  NON_REVENUE
}

enum RoutingChannel {
  DUFFEL
  CONSOLIDATOR
}

enum AirlineType {
  FSC
  LCC
  ULCC
  HYBRID
  REGIONAL
  CHARTER
  CARGO
}

enum AircraftCategory {
  NARROWBODY
  WIDEBODY
  REGIONAL_JET
  TURBOPROP
  BUSINESS_JET
  FREIGHTER
}

enum AirportType {
  LARGE
  MEDIUM
  SMALL
  CARGO
  MILITARY
}
