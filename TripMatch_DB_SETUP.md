# TripMatch Database Setup

## Database Migration Required

The TripMatch feature requires database tables to be created. You're seeing this error because the tables don't exist yet:

```
❌ Error: relation "trip_components" does not exist
```

## Quick Setup (Recommended)

### Option 1: Run via SQL Console (Neon Dashboard)

1. Go to your Neon database dashboard at https://console.neon.tech/
2. Select your project
3. Click on "SQL Editor"
4. Copy the entire contents of `lib/db/migrations/001_tripmatch_schema.sql`
5. Paste and execute in the SQL editor

### Option 2: Run via psql (if you have PostgreSQL client installed)

```bash
psql $DATABASE_URL < lib/db/migrations/001_tripmatch_schema.sql
```

### Option 3: Run via the migration script (requires local .env.local setup)

```bash
# Make sure DATABASE_URL is in your .env.local file
npx tsx scripts/run-migration.ts
```

## What Gets Created

The migration creates the following tables:

- **user_credits** - User credit balances and history
- **credit_transactions** - Transaction ledger for all credit movements
- **trip_groups** - Main trip/group travel listings
- **trip_components** - Trip components (flights, hotels, cars, tours)
- **group_members** - Trip members and their roles
- **group_bookings** - Individual bookings within trips
- **tripmatch_user_profiles** - Extended user profiles for TripMatch
- **trip_activities** - Activity feed for trips
- **trip_posts** - Social posts within trips
- **trip_messages** - Chat messages for trips

Plus all necessary indexes for optimal query performance.

## After Migration

Once the tables are created, the TripMatch features will work:

- ✅ Browse group trips on `/home-new`
- ✅ View trip details at `/tripmatch/trips/[id]`
- ✅ Credit rewards system
- ✅ Trip creation and management APIs

## Troubleshooting

If you see errors after running the migration:

1. Check that all tables were created: `\dt` in psql or check Neon dashboard
2. Verify DATABASE_URL is correct in .env.local
3. Make sure your database user has CREATE TABLE permissions
4. Check server logs for specific error messages

## Demo Data (Optional)

The schema includes `CREATE TABLE IF NOT EXISTS` so it's safe to run multiple times. Sample data is being generated by the TripMatch seed script when available.
